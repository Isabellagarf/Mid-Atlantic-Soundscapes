---
output: html_document
editor_options: 
  chunk_output_type: console
---
title: "A.E.Smith Mid-Atlantic Fish Chorusing"
author: "Anne E. Smith"
date: "2025-08-12"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## libraries

```{r}
library(PAMscapes)
library(ggplot2)
library(tidyverse)
library(lubridate)
library(here)
library(dplyr)
library(car)
library(patchwork)
library(ggpubr)
library(rstatix)
library(PAMmisc)
library(dunn.test)
library(smplot2)
library(tsibble)
library(scales)
library(ggpmisc)
library(paletteer)
library(ggh4x)
library(suntools)
library(zoo)
library(wesanderson)
library(openair)
library(reshape2)
library(fishualize)
library(gghighlight)
library(ggrepel)
library(multcompView)
library(showtext)
library(photobiology)
library(ggdaynight)
library(khroma)

```

# loading full HMD files per site

```{r}
#all_sites_HMD <- read.csv(here("data/all_sites_HMD.csv"))
#runSoundscapeExplorer(CB03_OL)

DB01_HMD <- read.csv(here("data/DB01_HMD.csv"))
DB01_HMD$UTC <- as.POSIXct(DB01_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB01_HMD$PLATFORM = "DB01"
DB02_HMD <- read.csv(here("data/DB02_HMD.csv"))
DB02_HMD$UTC <- as.POSIXct(DB02_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB02_HMD$PLATFORM = "DB02"
DB03_HMD <- read.csv(here("data/DB03_HMD.csv"))
DB03_HMD$UTC <- as.POSIXct(DB03_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB03_HMD$PLATFORM = "DB03"

ES01_HMD <- read.csv(here("data/ES01_HMD.csv"))
ES01_HMD$UTC <- as.POSIXct(ES01_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
ES01_HMD$PLATFORM = "ES01"
ES02_HMD <- read.csv(here("data/ES02_HMD.csv"))
ES02_HMD$UTC <- as.POSIXct(ES02_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
ES02_HMD$PLATFORM = "ES02"
ES03_HMD <- read.csv(here("data/ES03_HMD.csv"))
ES03_HMD$UTC <- as.POSIXct(ES03_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
ES03_HMD$PLATFORM = "ES03"

CB01_HMD <- read.csv(here("data/CB01_HMD.csv"))
CB01_HMD$UTC <- as.POSIXct(CB01_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB01_HMD$PLATFORM = "CB01"
CB02_HMD <- read.csv(here("data/dataCB02_HMD.csv"))
CB02_HMD$UTC <- as.POSIXct(CB02_HMD$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB02_HMD$PLATFORM = "CB02"
CB03_HMD <- read.csv(here("data/dataCB03_HMD.csv"))
CB03_HMD$UTC <- as.POSIXct(CB03_HMD$UTC, format= "%m/%d/%Y %H", tz = "GMT")
CB03_HMD <- CB03_HMD[-c(1)]
CB03_HMD$PLATFORM = "CB03"
```

```{r}
 all_sites <- DB01_HMD%>%
  full_join(DB02_HMD)%>%
  full_join(DB03_HMD)%>%
  full_join(ES01_HMD)%>%
  full_join(ES02_HMD)%>%
  full_join(ES03_HMD)%>%
  full_join(CB01_HMD)%>%
  full_join(CB02_HMD)%>%
  full_join(CB03_HMD)

all_sites$month <- month(all_sites$UTC)

all_sites$season = case_when(all_sites$month == 1 ~ "Winter",
                            all_sites$month == 2 ~ "Winter",
                            all_sites$month == 3 ~ "Spring",
                            all_sites$month == 4 ~ "Spring",
                            all_sites$month == 5 ~ "Spring",
                            all_sites$month == 6 ~ "Summer",
                            all_sites$month == 7 ~ "Summer",
                            all_sites$month == 8 ~ "Summer",
                            all_sites$month == 9 ~ "Fall",
                            all_sites$month == 10 ~ "Fall",
                            all_sites$month == 11 ~ "Fall",
                            all_sites$month == 12 ~ "Winter")
 
all_sites$season = factor(all_sites$season,
                                        levels= c("Winter", "Spring", "Summer", "Fall"),
                                        labels= c("Winter", "Spring", "Summer", "Fall"))

all_sites$PLATFORM = factor(all_sites$PLATFORM,
                                        levels= c("DB01", "DB02", "DB03", "ES01", "ES02", "ES03", "CB01", "CB02", "CB03"),
                                        labels= c("DB01", "DB02", "DB03", "ES01", "ES02", "ES03", "CB01", "CB02", "CB03"))

#by season
plotPSD(x=all_sites, style='quantile', q= 0.01, by='season', facet='PLATFORM')+
  labs(y= (expression(paste("Power Spectral Density dB re 1 \u00b5Pa" ^ "2", "/Hz"))))+
  theme(axis.text= element_text(size= 10),
        axis.title= element_text(size= 14),
        legend.text = element_text(size= 13),
        legend.title= element_text(size= 13.5),
        strip.text= element_text(size= 12))+
  scale_color_manual(labels= c("Winter", "Spring", "Summer", "Fall" ), values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  scale_fill_manual(values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  theme_bw()+
  guides(color= guide_legend(title= "Season"))

#by month
discrete_rainbow <- color("discrete rainbow", )
plotPSD(x=all_sites, style='quantile', by='month', facet='PLATFORM')+
  labs(y= (expression(paste("Power Spectral Density dB re 1 \u00b5Pa" ^ "2", "/Hz"))))+
  theme(axis.text= element_text(size= 10),
        axis.title= element_text(size= 14),
        legend.text = element_text(size= 13),
        legend.title= element_text(size= 13.5),
        strip.text= element_text(size= 12))+
  scale_color_manual(labels= c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"), values= c(discrete_rainbow(12)))+
  scale_fill_manual(values= c(discrete_rainbow(12)))+
  theme_bw()+
  guides(color= guide_legend(title= "month"))
 
 #all_sites$PLATFORM_order= factor(all_sites$PLATFORM, levels = c("DB01","DB02","DB03","ES01","ES02", "ES03", "CB01", "CB02","CB03"))

#write.csv(all_sites, here("data", "all_sites_HMD.csv")) #need to save after joining all sites again

#all_test <- read.csv(here("data/all_sites_HMD.csv"))
 
```
#converting to TOLs- shaded plot
```{r}
DB01_TOL <- createOctaveLevel(DB01_HMD, type= 'tol')
DB02_TOL <- createOctaveLevel(DB02_HMD, type= 'tol')
DB03_TOL <- createOctaveLevel(DB03_HMD, type= 'tol')

ES01_TOL <- createOctaveLevel(ES01_HMD, type= 'tol')
ES02_TOL <- createOctaveLevel(ES02_HMD, type= 'tol')
ES03_TOL <- createOctaveLevel(ES03_HMD, type= 'tol')

CB01_TOL <- createOctaveLevel(CB01_HMD, type= 'tol')
CB02_TOL <- createOctaveLevel(CB02_HMD, type= 'tol')
CB03_TOL <- createOctaveLevel(CB03_HMD, type= 'tol')

all_TOLSites <- DB01_TOL%>%
  full_join(DB02_TOL)%>%
  full_join(DB03_TOL)%>%
  full_join(ES01_TOL)%>%
  full_join(ES02_TOL)%>%
  full_join(ES03_TOL)%>%
  full_join(CB01_TOL)%>%
  full_join(CB02_TOL)%>%
  full_join(CB03_TOL)

#making seasonal plots

all_TOLSites$month <- month(all_TOLSites$UTC)

all_TOLSites$season = case_when(all_TOLSites$month == 1 ~ "Winter",
                            all_TOLSites$month == 2 ~ "Winter",
                            all_TOLSites$month == 3 ~ "Spring",
                            all_TOLSites$month == 4 ~ "Spring",
                            all_TOLSites$month == 5 ~ "Spring",
                            all_TOLSites$month == 6 ~ "Summer",
                            all_TOLSites$month == 7 ~ "Summer",
                            all_TOLSites$month == 8 ~ "Summer",
                            all_TOLSites$month == 9 ~ "Fall",
                            all_TOLSites$month == 10 ~ "Fall",
                            all_TOLSites$month == 11 ~ "Fall",
                            all_TOLSites$month == 12 ~ "Winter")

all_TOLSitesMed <- all_TOLSites%>%
  dplyr::group_by(season, PLATFORM)%>%
  dplyr::summarise(
    med_25= median(TOL_25, na.rm= TRUE),
    med_31.5= median(TOL_31.5, na.rm= TRUE),
    med_40= median(TOL_40, na.rm= TRUE),
    med_50= median(TOL_50, na.rm= TRUE),
    med_63= median(TOL_63, na.rm= TRUE),
    med_80= median(TOL_80, na.rm= TRUE),
    med_100= median(TOL_100, na.rm= TRUE),
    med_125= median(TOL_125, na.rm= TRUE),
    med_160= median(TOL_160, na.rm= TRUE),
    med_200= median(TOL_200, na.rm= TRUE),,
    med_250= median(TOL_250, na.rm= TRUE),
    med_315= median(TOL_315, na.rm= TRUE),
    med_400= median(TOL_400, na.rm= TRUE),
    med_500= median(TOL_500, na.rm= TRUE),
    med_630= median(TOL_630, na.rm= TRUE),
    med_800= median(TOL_800, na.rm= TRUE),
    med_1000= median(TOL_1000, na.rm= TRUE),
    med_1250= median(TOL_1250, na.rm= TRUE),
    med_1600= median(TOL_1600, na.rm= TRUE),
    med_2000= median(TOL_2000, na.rm= TRUE),
    med_2500= median(TOL_2500, na.rm= TRUE),
    med_3150= median(TOL_3150, na.rm= TRUE),
    med_4000= median(TOL_4000, na.rm= TRUE),
    med_5000= median(TOL_5000, na.rm= TRUE),
    med_6300= median(TOL_6300, na.rm= TRUE),
    med_8000= median(TOL_8000, na.rm= TRUE),
    med_10000= median(TOL_10000, na.rm= TRUE),
    med_12500= median(TOL_12500, na.rm= TRUE),
    med_16000= median(TOL_16000, na.rm= TRUE),
    med_20000= median(TOL_20000, na.rm= TRUE))

all_TOLSitesMed <- all_TOLSitesMed %>%
  pivot_longer(
    cols= !(season:PLATFORM),
    names_to= c(".value", "TOL_band"),
    names_sep = "_",
    values_drop_na = TRUE
  ) 

quants= c(0.05, 0.95)

all_TOLSitesQuant <- all_TOLSites %>%
  group_by(season, PLATFORM) %>%
  summarize(quant05_25 = quantile(TOL_25, probs= quants[1], na.rm= TRUE),
            quant95_25 = quantile(TOL_25, probs= quants[2], na.rm= TRUE),
            quant05_31.5 = quantile(TOL_31.5, probs= quants[1], na.rm= TRUE),
            quant95_31.5 = quantile(TOL_31.5, probs= quants[2], na.rm= TRUE),
            quant05_40 = quantile(TOL_40, probs= quants[1], na.rm= TRUE),
            quant95_40 = quantile(TOL_40, probs= quants[2], na.rm= TRUE),
            quant05_50 = quantile(TOL_50, probs= quants[1], na.rm= TRUE),
            quant95_50 = quantile(TOL_50, probs= quants[2], na.rm= TRUE),
            quant05_63 = quantile(TOL_63, probs= quants[1], na.rm= TRUE),
            quant95_63 = quantile(TOL_63, probs= quants[2], na.rm= TRUE),
            quant05_80 = quantile(TOL_80, probs= quants[1], na.rm= TRUE),
            quant95_80 = quantile(TOL_80, probs= quants[2], na.rm= TRUE),
            quant05_100 = quantile(TOL_100, probs= quants[1], na.rm= TRUE),
            quant95_100 = quantile(TOL_100, probs= quants[2], na.rm= TRUE),
            quant05_125 = quantile(TOL_125, probs= quants[1], na.rm= TRUE),
            quant95_125 = quantile(TOL_125, probs= quants[2], na.rm= TRUE),
            quant05_160 = quantile(TOL_160, probs= quants[1], na.rm= TRUE),
            quant95_160 = quantile(TOL_160, probs= quants[2], na.rm= TRUE),
            quant05_200 = quantile(TOL_200, probs= quants[1], na.rm= TRUE),
            quant95_200 = quantile(TOL_200, probs= quants[2], na.rm= TRUE),
            quant05_250 = quantile(TOL_250, probs= quants[1], na.rm= TRUE),
            quant95_250 = quantile(TOL_250, probs= quants[2], na.rm= TRUE),
            quant05_315 = quantile(TOL_315, probs= quants[1], na.rm= TRUE),
            quant95_315 = quantile(TOL_315, probs= quants[2], na.rm= TRUE),
            quant05_400 = quantile(TOL_400, probs= quants[1], na.rm= TRUE),
            quant95_400 = quantile(TOL_400, probs= quants[2], na.rm= TRUE),
            quant05_500 = quantile(TOL_500, probs= quants[1], na.rm= TRUE),
            quant95_500 = quantile(TOL_500, probs= quants[2], na.rm= TRUE),
            quant05_630 = quantile(TOL_630, probs= quants[1], na.rm= TRUE),
            quant95_630 = quantile(TOL_630, probs= quants[2], na.rm= TRUE),
            quant05_800 = quantile(TOL_800, probs= quants[1], na.rm= TRUE),
            quant95_800 = quantile(TOL_800, probs= quants[2], na.rm= TRUE),
            quant05_1000 = quantile(TOL_1000, probs= quants[1], na.rm= TRUE),
            quant95_1000 = quantile(TOL_1000, probs= quants[2], na.rm= TRUE),
            quant05_1250 = quantile(TOL_1250, probs= quants[1], na.rm= TRUE),
            quant95_1250 = quantile(TOL_1250, probs= quants[2], na.rm= TRUE),
            quant05_1600 = quantile(TOL_1600, probs= quants[1], na.rm= TRUE),
            quant95_1600 = quantile(TOL_1600, probs= quants[2], na.rm= TRUE),
            quant05_2000 = quantile(TOL_2000, probs= quants[1], na.rm= TRUE),
            quant95_2000 = quantile(TOL_2000, probs= quants[2], na.rm= TRUE),
            quant05_2500 = quantile(TOL_2500, probs= quants[1], na.rm= TRUE),
            quant95_2500 = quantile(TOL_2500, probs= quants[2], na.rm= TRUE),
            quant05_3150 = quantile(TOL_3150, probs= quants[1], na.rm= TRUE),
            quant95_3150 = quantile(TOL_3150, probs= quants[2], na.rm= TRUE),
            quant05_4000 = quantile(TOL_4000, probs= quants[1], na.rm= TRUE),
            quant95_4000 = quantile(TOL_4000, probs= quants[2], na.rm= TRUE),
            quant05_5000 = quantile(TOL_5000, probs= quants[1], na.rm= TRUE),
            quant95_5000 = quantile(TOL_5000, probs= quants[2], na.rm= TRUE),
            quant05_6300 = quantile(TOL_6300, probs= quants[1], na.rm= TRUE),
            quant95_6300 = quantile(TOL_6300, probs= quants[2], na.rm= TRUE),
            quant05_8000 = quantile(TOL_8000, probs= quants[1], na.rm= TRUE),
            quant95_8000 = quantile(TOL_8000, probs= quants[2], na.rm= TRUE),
            quant05_10000 = quantile(TOL_10000, probs= quants[1], na.rm= TRUE),
            quant95_10000 = quantile(TOL_10000, probs= quants[2], na.rm= TRUE),
            quant05_12500 = quantile(TOL_12500, probs= quants[1], na.rm= TRUE),
            quant95_12500 = quantile(TOL_12500, probs= quants[2], na.rm= TRUE),
            quant05_16000 = quantile(TOL_16000, probs= quants[1], na.rm= TRUE),
            quant95_16000 = quantile(TOL_16000, probs= quants[2], na.rm= TRUE),
            quant05_20000 = quantile(TOL_20000, probs= quants[1], na.rm= TRUE),
            quant95_20000 = quantile(TOL_20000, probs= quants[2], na.rm= TRUE))

all_TOLSitesQuant <- all_TOLSitesQuant %>%
  pivot_longer(
    cols= !(season:PLATFORM),
    names_to= c(".value", "TOL_band"),
    names_sep = "_",
    values_drop_na = TRUE
  ) 

long_all_TOLSites <- all_TOLSitesMed %>%
  full_join(all_TOLSitesQuant)

long_all_TOLSites$TOL_band = factor(long_all_TOLSites$TOL_band,
                                        levels= c("25", "31.5", "40", "50", "63", "80", "100", "125", "160", "200", "250", "315", "400", "500", "630", "800", "1000", "1250", "1600", "2000", "2500", "3150", "4000", "5000", "6300", "8000", "10000", "12500", "16000", "20000"),
                                        labels= c("25", "31.5", "40", "50", "63", "80", "100", "125", "160", "200", "250", "315", "400", "500", "630", "800", "1000", "1250", "1600", "2000", "2500", "3150", "4000", "5000", "6300", "8000", "10000", "12500", "16000", "20000"))

long_all_TOLSites$season = factor(long_all_TOLSites$season,
                                        levels= c("Winter", "Spring", "Summer", "Fall"),
                                        labels= c("Winter", "Spring", "Summer", "Fall"))


ggplot(long_all_TOLSites, aes(x= TOL_band, y= med, color= season, group= season))+
  geom_ribbon(aes(ymin= quant05,
                  ymax= quant95,
              fill= season, color= season), linetype= 1, linewidth= 0.2, alpha= 0.1)+
  scale_fill_manual(values= c("#a6cee3", "#1f78b4", "#d7191c","#fdae61"))+
  geom_point(size= 1.5)+ geom_line(linewidth= 1)+
  guides(fill= guide_legend(title= "Season"))+
  facet_wrap(factor(PLATFORM, levels = c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'))~., ncol= 3)+
  theme_bw()+
  xlab("Third-octave band (Hz)")+
  ylab(expression(paste('Median sound pressure levels (db re 1 \u00b5Pa)')))+
  scale_color_manual(values= c("#a6cee3", "#1f78b4", "#d7191c","#fdae61"))+
  guides(color= guide_legend(title= "Season"))+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


```
#seasonal PSDs- below OLs
```{r}
all_OLSites$month <- month(all_OLSites$UTC) ##this dataframe is in the OL files combining "inshore/offshore grouping" section

all_OLSites$season = case_when(all_OLSites$month == 1 ~ "winter",
                            all_OLSites$month == 2 ~ "winter",
                            all_OLSites$month == 3 ~ "spring",
                            all_OLSites$month == 4 ~ "spring",
                            all_OLSites$month == 5 ~ "spring",
                            all_OLSites$month == 6 ~ "summer",
                            all_OLSites$month == 7 ~ "summer",
                            all_OLSites$month == 8 ~ "summer",
                            all_OLSites$month == 9 ~ "fall",
                            all_OLSites$month == 10 ~ "fall",
                            all_OLSites$month == 11 ~ "fall",
                            all_OLSites$month == 12 ~ "winter")
  
all_OLSiteSeason<- all_OLSites %>% 
  group_by(season, PLATFORM, Lat, shore) %>% 
  dplyr::summarize(med_31.5 = median(OL_31.5, na.rm=TRUE),med_63 = median(OL_63, na.rm=TRUE),med_125 = median(OL_125, na.rm=TRUE),med_250 = median(OL_250, na.rm=TRUE),med_500 = median(OL_500, na.rm=TRUE), med_1000 = median(OL_1000, na.rm=TRUE),med_2000= median(OL_2000, na.rm= TRUE), med_4000 = median(OL_4000, na.rm=TRUE),med_8000= median(OL_8000, na.rm= TRUE), med_16000 = median(OL_16000, na.rm=TRUE))


melted_all_OLSiteSeason <- melt(all_OLSiteSeason, id= c("season", "PLATFORM", "Lat", "shore"), variable.name= "OL_band",
                                value.name= "med_seasonal_SPL")

melted_all_OLSiteSeason$season = factor(melted_all_OLSiteSeason$season,
                                        levels= c("winter", "spring", "summer", "fall"),
                                        labels= c("Winter", "Spring", "Summer", "Fall"))
melted_all_OLSiteSeason$OL_band = factor(melted_all_OLSiteSeason$OL_band,
                                        levels= c("med_31.5", "med_63", "med_125", "med_250", "med_500", "med_1000", "med_2000", "med_4000", "med_8000", "med_16000"),
                                        labels= c("31.5", "63", "125", "250","500", "1000", "2000", "4000", "8000", "16000"))

ggplot(melted_all_OLSiteSeason, aes(x= OL_band, y = med_seasonal_SPL, color= season, group= season))+
  geom_point()+ geom_line() +
  facet_wrap(factor(PLATFORM, levels = c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'))~., ncol= 3)+
  theme_bw()+
  xlab("Octave band (Hz)")+
  ylab(expression(paste('Median sound pressure levels (db re 1 \u00b5Pa)')))+
  scale_color_manual(values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  guides(color= guide_legend(title= "Season"))


#do this with HMD files instead
all_sites$month <- month(all_sites$UTC) 

all_sites$season = case_when(all_sites$month == 1 ~ "winter",
                            all_sites$month == 2 ~ "winter",
                            all_sites$month == 3 ~ "spring",
                            all_sites$month == 4 ~ "spring",
                            all_sites$month == 5 ~ "spring",
                            all_sites$month == 6 ~ "summer",
                            all_sites$month == 7 ~ "summer",
                            all_sites$month == 8 ~ "summer",
                            all_sites$month == 9 ~ "fall",
                            all_sites$month == 10 ~ "fall",
                            all_sites$month == 11 ~ "fall",
                            all_sites$month == 12 ~ "winter")
all_sites$season = factor(all_sites$season,
                                        levels= c("winter", "spring", "summer", "fall"),
                                        labels= c("Winter", "Spring", "Summer", "Fall"))

plotPSD(x=all_sites, style='quantile', q=0.01, by='season', facet='PLATFORM')+
  labs(y= (expression(paste("Power Spectral Density dB re 1 \u00b5Pa" ^ "2", "/Hz"))))+
  theme(axis.text= element_text(size= 10),
        axis.title= element_text(size= 14),
        legend.text = element_text(size= 13),
        legend.title= element_text(size= 13.5),
        strip.text= element_text(size= 12))+
  scale_color_manual(labels= c("Winter", "Spring", "Summer", "Fall"), values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  scale_fill_manual(values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  theme_bw()+
  guides(color= guide_legend(title= "Season"))#+
  facet_wrap(factor('PLATFORM', levels = c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'))~., ncol= 3)
  


#runSoundscapeExplorer(all_OLSites)
```
#testing median diel patterns across sites
```{r}
DB01_suntimes_med <- DB01_suntimes %>% 
  group_by(sun_time) %>% 
  dplyr::summarize(med_31.5 = median(OL_31.5, na.rm=TRUE),med_63 = median(OL_63, na.rm=TRUE),med_125 = median(OL_125, na.rm=TRUE),med_250 = median(OL_250, na.rm=TRUE),med_500 = median(OL_500, na.rm=TRUE), med_1000 = median(OL_1000, na.rm=TRUE),med_2000= median(OL_2000, na.rm= TRUE), med_4000 = median(OL_4000, na.rm=TRUE),med_8000= median(OL_8000, na.rm= TRUE), med_16000 = median(OL_16000, na.rm=TRUE))

melted_DB01_suntimes_med <- melt(DB01_suntimes_med, id= c("sun_time"), variable.name= "OL_band",
                                value.name= "med_diel_SPL")

melted_DB01_suntimes_med$OL_band = factor(melted_DB01_suntimes_med$OL_band,
                                        levels= c("med_31.5", "med_63", "med_125", "med_250", "med_500", "med_1000", "med_2000", "med_4000", "med_8000", "med_16000"),
                                        labels= c("31.5", "63", "125", "250","500", "1000", "2000", "4000", "8000", "16000"))

ggplot(melted_DB01_suntimes_med, aes(x= OL_band, y = med_diel_SPL, color= sun_time, group= sun_time))+
  geom_point()+ geom_line()+
  theme_bw()+
  xlab("Octave band (Hz)")+
  ylab(expression(paste('Median sound pressure levels (db re 1 \u00b5Pa)')))+
  scale_color_manual(values= c("#5761C0", "#DB2207"))+
  guides(color= guide_legend(title= "Time"))


```
# all sites
```{r}
all_sites <- inshore_sites %>%
  full_join(midshore_sites)%>%
  full_join(offshore_sites)

runSoundscapeExplorer(all_sites)

allSites_LTSA = plotLTSA(x=all_sites, facet= 'PLATFORM', units= expression(paste("dB re 1 \u00b5Pa" ^ "2", "/Hz"))) +
  facet_grid(factor(PLATFORM, levels = c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'))~.)+
  theme_bw()

plot(allSites_LTSA)
ggsave(here("figs", "allsites_LTSA.png"), allSites_LTSA, width= 24, height= 14, units= "in")

all_sites$PLATFORM = factor(all_sites$PLATFORM,
                                        levels= c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'),
                                        labels= c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'))

plotPSD(x=all_sites, style='quantile', q=0.01, dbRange= c(30, 120),facet='PLATFORM', by= "season")+
  facet_wrap(factor(PLATFORM, levels = c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'))~., ncol= 3)+
  theme_bw()+
  labs(y= (expression(paste("Power Spectral Density dB re 1 \u00b5Pa" ^ "2", "/Hz"))))


```
#inshore/offshore grouping
```{r}
#load back in csv from data folder next time!

inshore_sites <- DB01_HMD %>%
  full_join(ES01_HMD)%>%
  full_join(CB01_HMD)
inshore_sites$grouping = "Inshore"
inshore_OLSites <- DB01_OL %>%
  full_join(ES01_OL) %>%
  full_join(DB01_OL)

midshore_sites <- DB02_HMD %>%
  full_join(ES02_HMD)%>%
  full_join(CB02_HMD)%>%
  full_join(CB03_HMD)
midshore_sites$grouping= "Midshore"
midshore_OLSites <- DB02_OL %>%
  full_join(ES02_OL)%>%
  full_join(CB02_OL)%>%
  full_join(CB03_OL)

offshore_sites <- DB03_HMD %>%
  full_join(ES03_HMD)
offshore_sites$grouping="Offshore"
offshore_OLSites <- DB03_OL %>%
  full_join(ES03_OL)

all_grouped <- inshore_sites %>%
  full_join(midshore_sites)%>%
  full_join(offshore_sites)

DB_sites <- DB01_HMD %>%
  full_join(DB02_HMD)%>%
  full_join(DB03_HMD)
DB_sites$Latitudes = "Delaware Bay"
DB_OLSites <- DB01_OL %>%
  full_join(DB02_OL) %>%
  full_join(DB03_OL)

ES_sites <- ES01_HMD %>%
  full_join(ES02_HMD)%>%
  full_join(ES03_HMD)
ES_sites$Latitudes = "Eastern Seaboard"
ES_OLSites <- ES01_OL %>%
  full_join(ES02_OL)%>%
  full_join(ES03_OL)

CB_sites <- CB01_HMD %>% #will need to redo when CB02 error is fixed
  full_join(CB02_HMD)%>%
  full_join(CB03_HMD)
CB_sites$Latitudes = "Chesapeake Bay"
CB_OLSites <- CB01_OL %>%
  full_join(CB02_OL)%>%
  full_join(CB03_OL)

all_OLSites <- DB_OLSites %>%
  full_join(ES_OLSites)%>%
  full_join(CB_OLSites)

#all_latitudes <- DB_sites %>%
  full_join(ES_sites)%>%
  full_join(CB_sites)

#plotPSD(all_grouped, style='quantile', q=0.01, facet='grouping')+
  labs(y= (expression(paste("Power Spectral Density dB re 1 \u00b5Pa" ^ "2", "/Hz"))))+
  theme(axis.text= element_text(size= 10),
        axis.title= element_text(size= 14),
        legend.text = element_text(size= 13),
        legend.title= element_text(size= 13.5),
        strip.text= element_text(size= 12))

#runSoundscapeExplorer(all_grouped)

```
#making LTSAs
```{r}

inshore_LTSA = plotLTSA(x=inshore_sites, facet= 'PLATFORM') +
 # facet_grid(~factor(PLATFORM, levels = c('DB01', 'ES01', 'CB01')))+
  theme_bw()

midshore_LTSA = plotLTSA(x=midshore_sites, facet= 'PLATFORM') +
  #facet_grid(~factor(PLATFORM, levels = c('DB02', 'ES02', 'CB02', 'CB03')))+
  theme_bw()

offshore_LTSA = plotLTSA(x=offshore_sites, facet= 'PLATFORM') +
  #facet_grid(~factor(PLATFORM, levels = c('DB03', 'ES03')))+
  theme_bw()


DB_LTSA = plotLTSA(x=DB_sites, facet= 'PLATFORM') +
  theme_bw()

ES_LTSA = plotLTSA(x=ES_sites, facet= 'PLATFORM') +
  theme_bw()

CB_LTSA = plotLTSA(x=CB_sites, facet= 'PLATFORM') +
  theme_bw()

plot(CB_LTSA)

```
#plotting sites by group
```{r}

runSoundscapeExplorer(DB_sites)

plotPSD(x=midshore_sites, style='quantile', q=0.01, by='PLATFORM', facet='month')+
  labs(y= (expression(paste("Power Spectral Density dB re 1 \u00b5Pa" ^ "2", "/Hz"))))+
  theme(axis.text= element_text(size= 10),
        axis.title= element_text(size= 14),
        legend.text = element_text(size= 13),
        legend.title= element_text(size= 13.5),
        strip.text= element_text(size= 12))+
  scale_color_manual(labels= c("DB02", "ES02", "CB02", "CB03"), values= c("#00797F90","#00308790", "#B7130090", "#B7130080"))+
  scale_fill_manual(values= c("#00797F90","#00308790", "#B7130090"))+
  theme_bw()+
  guides(color= guide_legend(title= "Platform"))


plotPSD(x=offshore_sites, style='quantile', q=0.01, facet='PLATFORM')+
  labs(y= (expression(paste("Power Spectral Density dB re 1 \u00b5Pa" ^ "2", "/Hz"))))+
  theme(axis.text= element_text(size= 12),
        axis.title= element_text(size= 14),
        legend.text = element_text(size= 13),
        legend.title= element_text(size= 13.5),
        strip.text= element_text(size= 12))
guides(color= guide_legend(title= "Month")) #add back to plot if using other PSDs


DB_plot <- plotPSD(DB_sites, 
                     style = "quantile",
                     scale = "log",
                     q = 0.1,
                     color = "black",
                     units = expression(paste("dB re 1", mu, "Pa"^"2", "Hz"^"-1")),
                     freqRange = c(20,24000),
                     by = c("PLATFORM"))

DB_plot +
   scale_color_viridis_d(option = "mako", begin = 0.25, end = 0.75)+
   scale_fill_viridis_d(option = "mako", begin = 0.25, end = 0.75)+
   labs(color="Platform") +
   theme_bw()

ES_plot <- plotPSD(ES_sites, 
                     style = "quantile",
                     scale = "log",
                     q = 0.1,
                     color = "black",
                     units = expression(paste("dB re 1", mu, "Pa"^"2", "Hz"^"-1")),
                     freqRange = c(20,24000),
                     by = c("PLATFORM"))

ES_plot +
   scale_color_viridis_d(option = "mako", begin = 0.25, end = 0.75)+
   scale_fill_viridis_d(option = "mako", begin = 0.25, end = 0.75)+
   labs(color="Platform") +
   theme_bw()

inshore_plot <-  plotPSD(inshore_sites, 
                     style = "quantile",
                     scale = "log",
                     q = 0.1,
                     color = "black",
                     units = expression(paste("dB re 1", mu, "Pa"^"2", "Hz"^"-1")),
                     freqRange = c(20,24000),
                     by = c("PLATFORM"))
inshore_plot +
   scale_color_viridis_d(option = "magma", begin = 0.25, end = 0.75)+
   scale_fill_viridis_d(option = "magma", begin = 0.25, end = 0.75)+
   labs(color="Platform") +
   theme_bw()

midshore_plot <- plotPSD(midshore_sites,
                         style= "quantile",
                         scale= "log",
                         q= 0.1,
                         color= "black",
                         units= expression(paste("dB re 1", mu, "Pa"^"2", "Hz"^"-1")),
                         freqRange= c(20,24000),
                         by = c("PLATFORM"))
midshore_plot +
  scale_color_viridis_d(option= "magma", begin = 0.25, end = 0.75)+
  scale_fill_viridis_d(option = "magma", begin = 0.25, end = 0.75)+
  labs(color= "Platform")+
  theme_bw()

offshore_plot <- plotPSD(offshore_sites,
                         style= "quantile",
                         scale= "log",
                         q= 0.1,
                         color= "black",
                         units= expression(paste("dB re 1", mu, "Pa"^"2", "Hz"^"-1")),
                         freqRange= c(20,24000),
                         by = c("PLATFORM"))
offshore_plot +
  scale_color_viridis_d(option= "magma", begin = 0.25, end = 0.75)+
  scale_fill_viridis_d(option = "magma", begin = 0.25, end = 0.75)+
  labs(color= "Platform")+
  theme_bw()
  

```
#plots by specific months
```{r}
offshore_sites$month_num <- month(offshore_sites$UTC)
inshore_sites$month_num <- month(inshore_sites$UTC)
midshore_sites$month_num <- month(midshore_sites$UTC)

data_subset <- USArrests %>% filter(UrbanPop > 70)
plot(data_subset$Murder, data_subset$Assault)
inshore_chorusingMonths <- inshore_sites %>%
  filter(inshore_sites$month_num > 5 & inshore_sites$month_num <11)

inshore_chorusMonths_plot <- plotPSD(inshore_chorusingMonths,
                                     style= "quantile",
                                     scale= "log",
                                     color= "black",
                                     units= expression(paste("dB re 1", mu, "Pa"^"2", "Hz"^"-1")),
                                     freqRange= c(20,24000),
                                     by ="month",
                                     facet= 'PLATFORM')
inshore_chorusMonths_plot+
  scale_color_viridis_d(option = "magma", begin = 0.25, end = 0.75)+
  scale_fill_viridis_d(option= "magma", begin = 0.25, end = 0.75)+
  labs(color= "Month")+
  theme_bw()

#individual months
inshore_july_plot <- plotPSD(inshore_sites [inshore_sites$month_num == "7",],
                     style = "quantile",
                     scale = "log",
                     color = "black",
                     units = expression(paste("dB re 1", mu, "Pa"^"2", "Hz"^"-1")),
                     freqRange = c(20,24000),
                     by = 'month',
                   facet= 'PLATFORM')

inshore_july_plot +
   scale_color_viridis_d(option = "mako", begin = 0.25, end = 0.75)+
   scale_fill_viridis_d(option = "mako", begin = 0.25, end = 0.75)+
   labs(color="Month") +
   theme_bw()

```
## OCTAVE LEVEL FILES
```{r}
DB01_OL <- read.csv(here("data/DB01_OL.csv"))
DB01_OL <- DB01_OL[-c(1)]
DB01_OL$UTC_fixed <- paste(DB01_OL$UTC_date, DB01_OL$UTC_hour, sep = " ")
DB01_OL$UTC_fixed <- as.POSIXct(DB01_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
DB01_OL$PLATFORM = "DB01"
DB01_OL$shore = "Inshore"
DB01_OL$Lat = "Delaware"

DB02_OL <- read.csv(here("data/DB02_OL.csv"))
DB02_OL <- DB02_OL[-c(1)]
DB02_OL$UTC_fixed <- paste(DB02_OL$UTC_date, DB02_OL$UTC_hour, sep = " ")
DB02_OL$UTC_fixed <- as.POSIXct(DB02_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
DB02_OL$PLATFORM = "DB02"
DB02_OL$shore = "Mid-shore"
DB02_OL$Lat = "Delaware"

DB03_OL <- read.csv(here("data/DB03_OL.csv"))
DB03_OL <- DB03_OL[-c(1)]
DB03_OL$UTC_fixed <- paste(DB03_OL$UTC_date, DB03_OL$UTC_hour, sep = " ")
DB03_OL$UTC_fixed <- as.POSIXct(DB03_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
DB03_OL$PLATFORM = "DB03"
DB03_OL$shore = "Offshore"
DB03_OL$Lat = "Delaware"

ES01_OL <- read.csv(here("data/ES01_OL.csv"))
ES01_OL <- ES01_OL[-c(1)]
ES01_OL$UTC_fixed <- paste(ES01_OL$UTC_date, ES01_OL$UTC_hour, sep = " ")
ES01_OL$UTC_fixed <- as.POSIXct(ES01_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
ES01_OL$PLATFORM = "ES01"
ES01_OL$shore = "Inshore"
ES01_OL$Lat = "Eastern"

ES02_OL <- read.csv(here("data/ES02_OL.csv"))
ES02_OL <- ES02_OL[-c(1)]
ES02_OL$UTC_fixed <- paste(ES02_OL$UTC_date, ES02_OL$UTC_hour, sep = " ")
ES02_OL$UTC_fixed <- as.POSIXct(ES02_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
ES02_OL$PLATFORM = "ES02"
ES02_OL$shore = "Mid-shore"
ES02_OL$Lat = "Eastern"

ES03_OL <- read.csv(here("data/ES03_OL.csv"))
ES03_OL <- ES03_OL[-c(1)]
ES03_OL$UTC_fixed <- paste(ES03_OL$UTC_date, ES03_OL$UTC_hour, sep = " ")
ES03_OL$UTC_fixed <- as.POSIXct(ES03_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
ES03_OL$PLATFORM = "ES03"
ES03_OL$shore = "Offshore"
ES03_OL$Lat = "Eastern"

CB01_OL <- read.csv(here("data/CB01_OL.csv"))
CB01_OL <- CB01_OL[-c(1)]
CB01_OL$UTC_fixed <- paste(CB01_OL$UTC_date, CB01_OL$UTC_hour, sep = " ")
CB01_OL$UTC_fixed <- as.POSIXct(CB01_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
CB01_OL$PLATFORM = "CB01"
CB01_OL$shore = "Inshore"
CB01_OL$Lat = "Chesapeake"

CB02_OL <- read.csv(here("data/CB02_OL.csv"))
CB02_OL <- CB02_OL[-c(1)]
CB02_OL$UTC_fixed <- paste(CB02_OL$UTC_date, CB02_OL$UTC_hour, sep = " ")
CB02_OL$UTC_fixed <- as.POSIXct(CB02_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
CB02_OL$PLATFORM = "CB02"
CB02_OL$shore = "Mid-shore"
CB02_OL$Lat = "Chesapeake"

CB03_OL <- read.csv(here("data/CB03_OL.csv"))
CB03_OL <- CB03_OL[-c(1)]
CB03_OL$UTC_fixed <- paste(CB03_OL$UTC_date, CB03_OL$UTC_hour, sep = " ")
CB03_OL$UTC_fixed <- as.POSIXct(CB03_OL$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
CB03_OL$PLATFORM = "CB03"
CB03_OL$shore = "Mid-shore"
CB03_OL$Lat = "Chesapeake"

```
#loading in chorus presence files
```{r}
#DB01
DB01_chorusPresence <- read.csv(here("data/DB01_chorusPresence.csv"))
DB01_chorusPresence$X500_chorus = case_when(DB01_chorusPresence$X500_chorus == 1 ~ "yes",
                                            DB01_chorusPresence$X500_chorus == 0 ~ "no")
DB01_chorusPresence$X1000_chorus = case_when(DB01_chorusPresence$X1000_chorus == 1 ~ "yes",
                                            DB01_chorusPresence$X1000_chorus == 0 ~ "no")
DB01_chorusPresence$cusk_chorus = case_when(DB01_chorusPresence$cusk_chorus == 1 ~ "yes",
                                            DB01_chorusPresence$cusk_chorus == 0 ~ "no")
DB01_chorusPresence$oyster_chorus = case_when(DB01_chorusPresence$oyster_chorus == 1 ~ "yes",
                                            DB01_chorusPresence$oyster_chorus == 0 ~ "no")

DB01_chorusPresence$date <- as.Date(DB01_chorusPresence$date, format= "%m/%d/%Y")
colnames(DB01_chorusPresence)[1] <- "UTC"
DB01_chorusPresence$site = "DB01"

ES01_chorusPresence <- read.csv(here("data/ES01_chorusPresence.csv"))
ES01_chorusPresence$X500_chorus = case_when(ES01_chorusPresence$X500_chorus == 1 ~ "yes",
                                            ES01_chorusPresence$X500_chorus == 0 ~ "no")
ES01_chorusPresence$X1000_chorus = case_when(ES01_chorusPresence$X1000_chorus == 1 ~ "yes",
                                            ES01_chorusPresence$X1000_chorus == 0 ~ "no")
ES01_chorusPresence$X2000_chorus = case_when(ES01_chorusPresence$X2000_chorus == 1 ~ "yes",
                                            ES01_chorusPresence$X2000_chorus == 0 ~ "no")
ES01_chorusPresence$date <- as.Date(ES01_chorusPresence$date, format= "%m/%d/%Y")
colnames(ES01_chorusPresence)[1] <- "UTC"
ES01_chorusPresence$site = "ES01"

CB01_chorusPresence <- read.csv(here("data/CB01_chorusPresence.csv"))
CB01_chorusPresence$X500_chorus = case_when(CB01_chorusPresence$X500_chorus == 1 ~ "yes",
                                            CB01_chorusPresence$X500_chorus == 0 ~ "no")
CB01_chorusPresence$X1000_chorus = case_when(CB01_chorusPresence$X1000_chorus == 1 ~ "yes",
                                            CB01_chorusPresence$X1000_chorus == 0 ~ "no")
CB01_chorusPresence$X2000_chorus = case_when(CB01_chorusPresence$X2000_chorus == 1 ~ "yes",
                                            CB01_chorusPresence$X2000_chorus == 0 ~ "no")
CB01_chorusPresence$date <- as.Date(CB01_chorusPresence$date, format= "%m/%d/%Y")
colnames(CB01_chorusPresence)[1] <- "UTC"
CB01_chorusPresence$site = "CB01"
```
#plotting sunrise/sunset with chorus presence
```{r}
colnames(DB01_sunset)[19] <- "date"
DB01_chorusPresence$date <- as.Date(DB01_chorusPresence$date, format= "%m/%d/%Y")
DB01_subSunset <- subset(DB01_sunset, select = c(OL_500, OL_1000, OL_2000, PLATFORM, date, sunset_UTC_hour, sun_time))
DB01_subSunset$date <- as.Date(DB01_subSunset$date, format= "%Y-%m-%d")

DB01_chorusSunset <- DB01_chorusPresence %>%
  full_join(DB01_subSunset)

colnames(DB01_sunrise)[19] <- "date"
DB01_subSunrise <- subset(DB01_sunrise, select = c(OL_500, OL_1000, OL_2000, PLATFORM, date, sunrise_UTC_hour, sun_time))
DB01_subSunrise$date <- as.Date(DB01_subSunrise$date, format= "%Y-%m-%d")

DB01_chorusSunrise <- DB01_chorusPresence %>%
  full_join(DB01_subSunrise)
DB01_chorusSuntimes <- DB01_chorusSunset %>%
  full_join(DB01_chorusSunrise)


ggplot(DB01_chorusSunset, aes(x= date, y= OL_500, color=X500_chorus, group = 1))+
  geom_line()+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500 Hz Octave Level SPL (db re 1 \u00b5Pa) at sunset')))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  scale_fill_manual(values= c("#00308790", "#B7130090"))

DB01_500SunPresent = DB01_chorusSuntimes %>%
  filter(X500_chorus != c("no")) %>%
  filter(X1000_chorus != c("yes"))%>%
  filter(X2000_chorus != c("yes"))
DB01_1000SunPresent = DB01_chorusSuntimes %>%
  filter(X1000_chorus != c("no"))%>%
  filter(X500_chorus != c("yes")) %>%
  filter(X2000_chorus != c("yes"))
DB01_2000SunPresent = DB01_chorusSuntimes %>%
  filter(X2000_chorus != c("no"))%>%
  filter(X500_chorus != c("yes"))%>%
  filter(X1000_chorus != c("yes"))

chorus500_plot <- ggplot(DB01_500SunPresent, aes(x= date, y= OL_500, color= sun_time, group = 2))+
  geom_point()+
  theme_bw()+
  xlab("Date")+
  geom_hline(yintercept = 100, col= "black")+
  ylab(expression(paste('Median 500 Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  scale_fill_manual(values= c("#00308790", "#B7130090"))

chorus1000_plot <- ggplot(DB01_1000SunPresent, aes(x= date, y= OL_1000, color= sun_time, group = 2))+
  geom_point()+
  theme_bw()+
  xlab("Date")+
  geom_hline(yintercept = 100, col= "black")+
  ylab(expression(paste('Median 1000 Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  scale_fill_manual(values= c("#00308790", "#B7130090"))

chorus2000_plot <- ggplot(DB01_2000SunPresent, aes(x= date, y= OL_2000, color= sun_time, group = 2))+
  geom_point()+
  theme_bw()+
  xlab("Date")+
  geom_hline(yintercept = 100, col= "black")+
  ylab(expression(paste('Median 2000 Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  scale_fill_manual(values= c("#00308790", "#B7130090"))

chorus500_plot/chorus1000_plot/chorus2000_plot +plot_layout(guides = "collect", axis_titles = "collect")

```
##temps
```{r}
#DB01
DB01_202207Temp <- read.csv(here("data/Temp_data/NEFSC_DE_202207_DB01_Filtered_ST_Temp_data.csv"))
DB01_202207Temp$Datetime_UTC <- as.POSIXct(DB01_202207Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
DB01_202301Temp <- read.csv(here("data/Temp_data/NEFSC_DE_202301_DB01_Filtered_ST_Temp_data.csv"))
DB01_202301Temp$Datetime_UTC <- as.POSIXct(DB01_202301Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
DB01_202306Temp <- read.csv(here("data/Temp_data/NEFSC_DE_202306_DB01_Filtered_ST_Temp_data.csv"))
DB01_202306Temp$Datetime_UTC <- as.POSIXct(DB01_202306Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
DB01_202311Temp <- read.csv(here("data/Temp_data/NEFSC_DE_202311_DB01_Filtered_ST_Temp_data.csv"))
DB01_202311Temp$Datetime_UTC <- as.POSIXct(DB01_202311Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
DB01_202405Temp <- read.csv(here("data/Temp_data/NEFSC_DE_202405_DB01_8015_Filtered_ST_Temp_data.csv"))
DB01_202405Temp$Datetime_UTC <- as.POSIXct(DB01_202405Temp$Datetime_UTC, format = "%m-%d-%Y_%H:%M:%S")
DB01_202411Temp <- read.csv(here("data/Temp_data/NEFSC_DE_202411_DB01_6105_Filtered_ST_Temp_data.csv"))
DB01_202411Temp$Datetime_UTC <- as.POSIXct(DB01_202411Temp$Datetime_UTC, format = "%m-%d-%Y_%H:%M:%S")
DB01_temps <- DB01_202207Temp %>%
  full_join(DB01_202301Temp)%>%
  full_join(DB01_202306Temp)%>%
  full_join(DB01_202311Temp)%>%
  full_join(DB01_202405Temp)%>%
  full_join(DB01_202411Temp)

#ES01
ES01_202310Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202310_ES01_Filtered_ST_Temp_data.csv"))
ES01_202310Temp$Datetime_UTC <- as.POSIXct(ES01_202310Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
ES01_202404Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202404_ES01_6105_Filtered_ST_Temp_data.csv"))
ES01_202404Temp$Datetime_UTC <- as.POSIXct(ES01_202404Temp$Datetime_UTC, format = "%m-%d-%Y_%H:%M:%S")
ES01_202409Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202409_ES01_6104_Filtered_ST_Temp_data.csv"))
ES01_202409Temp$Datetime_UTC <- as.POSIXct(ES01_202409Temp$Datetime_UTC, format = "%m-%d-%Y_%H:%M:%S")
ES01_temps <- ES01_202310Temp %>%
  full_join(ES01_202404Temp)%>%
  full_join(ES01_202409Temp)

#CB01
CB01_202206Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202206_CB01_Filtered_ST_Temp_data.csv"))
CB01_202206Temp$Datetime_UTC <- as.POSIXct(CB01_202206Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
CB01_202212Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202212_CB01_Filtered_ST_Temp_data.csv"))
CB01_202212Temp$Datetime_UTC <- as.POSIXct(CB01_202212Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
CB01_202306Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202306_CB01_Filtered_ST_Temp_data.csv"))
CB01_202306Temp$Datetime_UTC <- as.POSIXct(CB01_202306Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
CB01_202311Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202311_CB01_Filtered_ST_Temp_data.csv"))
CB01_202311Temp$Datetime_UTC <- as.POSIXct(CB01_202311Temp$Datetime_UTC, format = "%d-%m-%Y_%H:%M:%S")
CB01_202405Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202405_CB01_8014_Filtered_ST_Temp_data.csv"))
CB01_202405Temp$Datetime_UTC <- as.POSIXct(CB01_202405Temp$Datetime_UTC, format = "%m-%d-%Y_%H:%M:%S")
CB01_202411Temp <- read.csv(here("data/Temp_data/NEFSC_VA_202411_CB01_8015_Filtered_ST_Temp_data.csv"))
CB01_202411Temp$Datetime_UTC <- as.POSIXct(CB01_202411Temp$Datetime_UTC, format = "%m-%d-%Y_%H:%M:%S")

CB01_temps <- CB01_202206Temp %>%
  full_join(CB01_202212Temp) %>%
  full_join(CB01_202306Temp)%>%
  full_join(CB01_202311Temp)%>%
  full_join(CB01_202405Temp)%>%
  full_join(CB01_202411Temp)

DB01_temps$Date <- as.POSIXct(DB01_temps$Date, format = "%Y-%m-%d")
DB01_temps$UTC_fixed <- droplevels(cut(DB01_temps$Datetime_UTC, breaks= "hour"))
DB01_temps$UTC_fixed <- as.POSIXct(DB01_temps$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
DB01_OL <- DB01_OL %>%
  full_join(DB01_temps)
DB01_OLTemps <- DB01_OL %>%
  select(UTC_fixed, Datetime_UTC, OL_500, OL_1000, OL_2000, Internal_temp_C, PLATFORM)


DB01_OLTemps$UTC <- droplevels(cut(DB01_OLTemps$UTC_fixed, breaks= "day"))
DB01_OLtemps_daily <- DB01_OLTemps %>% 
  group_by(UTC) %>% 
  dplyr::summarize(med_500 = median(OL_500, na.rm=TRUE), med_1000= median(OL_1000, na.rm= TRUE), med_2000= median(OL_2000, na.rm= TRUE), med_temp= median(Internal_temp_C, na.rm= TRUE))

DB01_OLtemps_daily$UTC <- as.Date(DB01_OLtemps_daily$UTC, format= "%Y-%m-%d")


DBOL_500_dailyTemps_Plot = ggplot(data = DB01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+92), color="pink", size=1)+
  geom_line(mapping= aes(y=med_500)) + 
  scale_y_continuous(expression(paste("Daily Median 500 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -92, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  geom_hline(yintercept= 107, col= "pink", size= .75)+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(title= "DB01",
       x= "Date (UTC)")

DBOL_1000_dailyTemps_Plot = ggplot(data = DB01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+88), color="pink", size=1)+
  geom_line(mapping= aes(y=med_1000)) + 
  scale_y_continuous(expression(paste("Daily Median 1000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -88, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  geom_hline(yintercept= 103, col= "pink", size= .75)+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(x= "Date (UTC)")

DBOL_2000_dailyTemps_Plot = ggplot(data = DB01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+94), color="pink", size=1)+
  geom_line(mapping= aes(y=med_2000)) + 
  scale_y_continuous(expression(paste("Daily Median 2000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -94, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  geom_hline(yintercept= 109, col= "pink", size= .75)+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(x= "Date (UTC)")

DBOL_500_dailyTemps_Plot/DBOL_1000_dailyTemps_Plot/DBOL_2000_dailyTemps_Plot+ plot_layout(axis_titles = "collect", guides= "collect")



#ES01 temps
ES01_temps$Date <- as.POSIXct(ES01_temps$Date, format = "%Y-%m-%d")
ES01_temps$UTC_fixed <- droplevels(cut(ES01_temps$Datetime_UTC, breaks= "hour"))
ES01_temps$UTC_fixed <- as.POSIXct(ES01_temps$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
ES01_OL <- ES01_OL %>%
  full_join(ES01_temps)
ES01_OLTemps <- ES01_OL %>%
  select(UTC_fixed, Datetime_UTC, OL_500, OL_1000, OL_2000, Internal_temp_C, PLATFORM)

ES01_OLTemps$UTC <- droplevels(cut(ES01_OLTemps$UTC_fixed, breaks= "day"))
ES01_OLtemps_daily <- ES01_OLTemps %>% 
  group_by(UTC) %>% 
  dplyr::summarize(med_500 = median(OL_500, na.rm=TRUE), med_1000= median(OL_1000, na.rm= TRUE), med_2000= median(OL_2000, na.rm= TRUE), med_temp= median(Internal_temp_C, na.rm= TRUE))

ES01_OLtemps_daily$UTC <- as.Date(ES01_OLtemps_daily$UTC, format= "%Y-%m-%d")

ESOL_500_dailyTemps_Plot = ggplot(data = ES01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+94), color="orange", size=1)+
  geom_line(mapping= aes(y=med_500)) + 
  scale_y_continuous(expression(paste("Daily Median 500 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -94, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(title= "ES01",
       x= "Date (UTC)")

ESOL_1000_dailyTemps_Plot = ggplot(data = ES01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+91), color="orange", size=1)+
  geom_line(mapping= aes(y=med_1000)) + 
  scale_y_continuous(expression(paste("Daily Median 1000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -91, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(x= "Date (UTC)")

ESOL_2000_dailyTemps_Plot = ggplot(data = ES01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+90), color="orange", size=1)+
  geom_line(mapping= aes(y=med_2000)) + 
  scale_y_continuous(expression(paste("Daily Median 2000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -90, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(x= "Date (UTC)")

ESOL_500_dailyTemps_Plot/ESOL_1000_dailyTemps_Plot/ESOL_2000_dailyTemps_Plot+ plot_layout(axis_titles = "collect", guides= "collect")

#CB01 temps

CB01_temps$Date <- as.POSIXct(CB01_temps$Date, format = "%Y-%m-%d")
CB01_temps$UTC_fixed <- droplevels(cut(CB01_temps$Datetime_UTC, breaks= "hour"))
CB01_temps$UTC_fixed <- as.POSIXct(CB01_temps$UTC_fixed, format = "%Y-%m-%d %H:%M:%S")
CB01_OL <- CB01_OL %>%
  full_join(CB01_temps)
CB01_OLTemps <- CB01_OL %>%
  select(UTC_fixed, Datetime_UTC, OL_500, OL_1000, OL_2000, Internal_temp_C, PLATFORM)

CB01_OLTemps$UTC <- droplevels(cut(CB01_OLTemps$UTC_fixed, breaks= "day"))
CB01_OLtemps_daily <- CB01_OLTemps %>% 
  group_by(UTC) %>% 
  dplyr::summarize(med_500 = median(OL_500, na.rm=TRUE), med_1000= median(OL_1000, na.rm= TRUE), med_2000= median(OL_2000, na.rm= TRUE), med_temp= median(Internal_temp_C, na.rm= TRUE))

CB01_OLtemps_daily$UTC <- as.Date(CB01_OLtemps_daily$UTC, format= "%Y-%m-%d")

CBOL_500_dailyTemps_Plot = ggplot(data = CB01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+96), color="purple", size=1, alpha= 0.5)+
  geom_line(mapping= aes(y=med_500)) + 
  scale_y_continuous(expression(paste("Daily Median 500 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -96, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(title= "CB01",
       x= "Date (UTC)")

CBOL_1000_dailyTemps_Plot = ggplot(data = CB01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+90), color="purple", size=1, alpha= 0.5)+
  geom_line(mapping= aes(y=med_1000)) + 
  scale_y_continuous(expression(paste("Daily Median 1000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -90, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(x= "Date (UTC)")

CBOL_2000_dailyTemps_Plot = ggplot(data = CB01_OLtemps_daily, mapping = aes(x =UTC)) + 
  geom_line(mapping = aes(y = med_temp+90), color="purple", size=1, alpha= 0.5)+
  geom_line(mapping= aes(y=med_2000)) + 
  scale_y_continuous(expression(paste("Daily Median 2000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -90, name = "Daily Median Temperature (°C)")
  )+
  geom_hline(yintercept = 100, col= "black")+
  theme_bw()+
  scale_x_date(limits= as.Date(c("2022-06-10", "2024-11-07")))+
  labs(x= "Date (UTC)")

CBOL_500_dailyTemps_Plot/CBOL_1000_dailyTemps_Plot/CBOL_2000_dailyTemps_Plot+ plot_layout(axis_titles = "collect", guides= "collect")

#OL grouping
DBOL_500_dailyTemps_Plot/ESOL_500_dailyTemps_Plot/CBOL_500_dailyTemps_Plot+ plot_layout(axis_titles = "collect", guides= "collect")

DBOL_1000_dailyTemps_Plot/ESOL_1000_dailyTemps_Plot/CBOL_1000_dailyTemps_Plot+ plot_layout(axis_titles = "collect", guides= "collect")

DBOL_2000_dailyTemps_Plot/ESOL_2000_dailyTemps_Plot/CBOL_2000_dailyTemps_Plot+ plot_layout(axis_titles = "collect", guides= "collect")
```
#moon phases
```{r}
moon_phases <- read.csv(here("data/moon_phases.csv"))
moon_phases$Date <- as.Date(moon_phases$Date, format= "%Y %b %e")
colnames(moon_phases)[2] <- "UTC_date"
moon_phases$Time..Universal.Time. <- as.POSIXct(moon_phases$Time..Universal.Time., format= "%H:%M")
moon_phases <- moon_phases %>%
  mutate(UTC_hour = hour(Time..Universal.Time.))%>%
  mutate(UTC_minute = minute(Time..Universal.Time.))
moon_phases$UTC_hour <- as.character(moon_phases$UTC_hour)
moon_phases$UTC_minute <- as.character(moon_phases$UTC_minute)
moon_phasesUTC_date <- as.character(moon_phases$UTC_date)
moon_phases <- moon_phases[-c(3)]
moon_phases$UTC_1 <- paste(moon_phases$UTC_date, moon_phases$UTC_hour, sep = " ")
moon_phases$UTC <- paste(moon_phases$UTC_1, moon_phases$UTC_minute , sep = ":")
moon_phases$UTC = as.POSIXct(moon_phases$UTC, format = "%Y-%m-%d %H:%M", tz= "UTC")


moon_phases2 <- read.csv(here("data/moon_phases2.csv"))
moon_phases2$Date <- as.Date(moon_phases2$Date, format= "%Y %b %e")
colnames(moon_phases2)[2] <- "UTC"
moon_phases2 <- moon_phases2[-c(3,4,5,6,7)]
moon_phases <- moon_phases %>%
  full_join(moon_phases2)

DB01_envData_daily <- DB01_OLtemps_daily%>%
  full_join(moon_phases)
DB01_envData_daily$Moon.Phase = case_when(DB01_envData_daily$Moon.Phase == "Full Moon" ~ 4,
                                          DB01_envData_daily$Moon.Phase == "New Moon" ~ 1,
                                          DB01_envData_daily$Moon.Phase == "First Quarter" ~ 2,
                                          DB01_envData_daily$Moon.Phase == "Last Quarter" ~ 3,
                                          DB01_envData_daily$Moon.Phase == NA ~ 0)


Env500OL_plot = ggplot(data = DB01_envData_daily, mapping = aes(x =UTC)) + 
  geom_rect(data= (DB01_envData_daily %>% filter(Moon.Phase== 1)), aes(xmin= UTC-1, xmax= UTC+1, ymin= -Inf, ymax= Inf, fill = "Full Moon"), linetype= "blank", alpha = 0.5)+
  geom_rect(data= (DB01_envData_daily %>% filter(Moon.Phase== 2)), aes(xmin= UTC-1, xmax= UTC+1, ymin= -Inf, ymax= Inf, fill = "New Moon"), linetype= "blank", alpha = 0.5)+
  scale_fill_manual(values = c("lightblue", "grey"))+
  geom_line(mapping = aes(y = med_temp+90, color= "Temp"), size=1)+
  scale_color_manual(NULL, values= "pink")+
  geom_line(mapping= aes(y=med_500)) + 
  scale_y_continuous(expression(paste("Daily Median 500 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -90, name = "Daily Median Temperature (°C)"))+
  geom_hline(yintercept = 100, col= "black")+
  stat_peaks(mapping= aes(x= UTC, y= med_500),
             color= "red",
             geom = "point",
             span= 5,
             global.threshold = I(107.5))+
  theme_bw()+
  theme(panel.grid = element_blank())+
  scale_x_date(limits= as.Date(c("2022-07-07", "2024-11-03")))+
  labs(title= "DB01",
       x= "Date (UTC)")+
  guides(fill= guide_legend(title= "Moon Phase"))#+
  geom_text_repel(aes(x = UTC, y = med_500, label = label))

plot(Env500OL_plot)

Env1000OL_plot = ggplot(data = DB01_envData_daily, mapping = aes(x =UTC)) + 
  geom_rect(data= (DB01_envData_daily %>% filter(Moon.Phase== 1)), aes(xmin= UTC-1, xmax= UTC+1, ymin= -Inf, ymax= Inf, fill = "Full Moon"), linetype= "blank", alpha = 0.5)+
  geom_rect(data= (DB01_envData_daily %>% filter(Moon.Phase== 2)), aes(xmin= UTC-1, xmax= UTC+1, ymin= -Inf, ymax= Inf, fill = "New Moon"), linetype= "blank", alpha = 0.5)+
  scale_fill_manual(values = c("lightblue", "grey"))+
  geom_line(mapping = aes(y = med_temp+90), color="pink", size=1)+
  geom_line(mapping= aes(y=med_1000)) + 
  scale_y_continuous(expression(paste("Daily Median 1000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -90, name = "Daily Median Temperature (°C)")
  )+geom_hline(yintercept = 100, col= "black")+
  stat_peaks(mapping= aes(x= UTC, y= med_1000),
             color= "red",
             geom = "point",
             span= 5,
             global.threshold = I(107.5))+
  theme_bw()+
  theme(panel.grid = element_blank())+
  scale_x_date(limits= as.Date(c("2022-07-07", "2024-11-03")))+
  labs(x= "Date (UTC)")+
  guides(fill= guide_legend(title= "Moon Phase"))

Env2000OL_plot = ggplot(data = DB01_envData_daily, mapping = aes(x =UTC)) + 
  geom_rect(data= (DB01_envData_daily %>% filter(Moon.Phase== 1)), aes(xmin= UTC-1, xmax= UTC+1, ymin= -Inf, ymax= Inf, fill = "Full Moon"), linetype= "blank", alpha = 0.5)+
  geom_rect(data= (DB01_envData_daily %>% filter(Moon.Phase== 2)), aes(xmin= UTC-1, xmax= UTC+1, ymin= -Inf, ymax= Inf, fill = "New Moon"), linetype= "blank", alpha = 0.5)+
  scale_fill_manual(values = c("lightblue", "grey"))+
  geom_line(mapping = aes(y = med_temp+90), color="pink", size=1)+
  geom_line(mapping= aes(y=med_2000)) + 
  scale_y_continuous(expression(paste("Daily Median 2000 Hz OL SPL (dB re \u00b5Pa" ^ "2", "/Hz)")), 
                     sec.axis = sec_axis(~ . -90, name = "Daily Median Temperature (°C)")
  )+geom_hline(yintercept = 100, col= "black")+
  stat_peaks(mapping= aes(x= UTC, y= med_2000),
             color= "red",
             geom = "point",
             span= 5,
             global.threshold = I(107.5))+
  theme_bw()+
  theme(panel.grid = element_blank())+
  scale_x_date(limits= as.Date(c("2022-07-07", "2024-11-03")))+
  labs(x= "Date (UTC)")+
  guides(fill= guide_legend(title= "Moon Phase"))

Env500OL_plot/Env1000OL_plot/Env2000OL_plot+ plot_layout(axis_titles = "collect", guides= "collect")

```
# inshore/offshore gradient using OL
```{r}
inshore_sites_OL <- DB01_OL %>%
  full_join(ES01_OL)%>%
  full_join(CB01_OL)

DB_OL <- DB01_OL %>%
  full_join(DB02_OL) %>%
  full_join(DB03_OL)

ggplot(inshore_sites_OL, aes(x= UTC_fixed, y= OL_500, color = PLATFORM))+
  geom_line()+
  theme_bw()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  scale_color_manual(values= c("#00797F90","#00308790", "#B7130090"))
```
#only plotting sunset hours
```{r}
#DB01
DB01_location <- matrix(c(-74.82, 38.71), nrow = 1)
DB01_date_Time <- seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2024-11-08 16:00:00"), by = "1 hour")

Sunset <- sunriset(crds = DB01_location, dateTime = DB01_date_Time, direction = "sunset", POSIXct.out = TRUE)
sunset_datehour <- Sunset %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunset_UTC_hour = hour(time))

sunset_datehour <- sunset_datehour %>%
  group_by(UTC_date, sunset_UTC_hour)%>%
  summarize(n = n())
sunset_datehour$sunset_UTC_hour <- as.character(sunset_datehour$sunset_UTC_hour)
sunset_datehour$UTC_date <- as.character(sunset_datehour$UTC_date)
sunset_datehour <- sunset_datehour[-c(3)]
sunset_datehour$UTC_fixed <- paste(sunset_datehour$UTC_date, sunset_datehour$sunset_UTC_hour, sep = " ")
sunset_datehour$UTC_fixed = as.POSIXct(sunset_datehour$UTC_fixed, format = "%Y-%m-%d %H")


DB01_sunset <- DB01_OL %>%
  right_join(sunset_datehour, join_by(UTC_fixed))

DB01_500Hz <- ggplot(DB01_sunset, aes(x= UTC_fixed, y= OL_500))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))
DB01_2000Hz <- ggplot(DB01_sunset, aes(x= UTC_fixed, y= OL_2000))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))

DB01_500Hz/DB01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")

#ES01
ES01_location <- matrix(c(-75.29, 37.69), nrow = 1)
ES01_date_Time <- seq(ymd_hms("2023-10-13 00:00:00"), ymd_hms("2024-09-29 18:00:00"), by = "1 hour")

ES01Sunset <- sunriset(crds = ES01_location, dateTime = ES01_date_Time, direction = "sunset", POSIXct.out = TRUE)
ES01sunset_datehour <- ES01Sunset %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunset_UTC_hour = hour(time))
ES01sunset_datehour <- ES01sunset_datehour %>%
  group_by(UTC_date, sunset_UTC_hour)%>%
  summarize(n = n())
ES01sunset_datehour$sunset_UTC_hour <- as.character(ES01sunset_datehour$sunset_UTC_hour)
ES01sunset_datehour$UTC_date <- as.character(ES01sunset_datehour$UTC_date)
ES01sunset_datehour <- ES01sunset_datehour[-c(3)]
ES01sunset_datehour$UTC_fixed <- paste(ES01sunset_datehour$UTC_date, ES01sunset_datehour$sunset_UTC_hour, sep = " ")
ES01sunset_datehour$UTC_fixed = as.POSIXct(ES01sunset_datehour$UTC_fixed, format = "%Y-%m-%d %H")

ES01_sunset <- ES01_OL %>%
  right_join(ES01sunset_datehour, join_by(UTC_fixed))

ES01_500Hz <- ggplot(ES01_sunset, aes(x= UTC_fixed, y= OL_500))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))
ES01_2000Hz <- ggplot(ES01_sunset, aes(x= UTC_fixed, y= OL_2000))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))

ES01_500Hz/ES01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")


#CB01
CB01_location <- matrix(c(-75.67, 36.98), nrow = 1)
CB01_date_Time <- seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2024-11-08 16:00:00"), by = "1 hour")

CB01Sunset <- sunriset(crds = CB01_location, dateTime = CB01_date_Time, direction = "sunset", POSIXct.out = TRUE)
CB01sunset_datehour <- CB01Sunset %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunset_UTC_hour = hour(time))
CB01sunset_datehour <- CB01sunset_datehour %>%
  group_by(UTC_date, sunset_UTC_hour)%>%
  summarize(n = n())
CB01sunset_datehour$sunset_UTC_hour <- as.character(CB01sunset_datehour$sunset_UTC_hour)
CB01sunset_datehour$UTC_date <- as.character(CB01sunset_datehour$UTC_date)
CB01sunset_datehour <- CB01sunset_datehour[-c(3)]
CB01sunset_datehour$UTC_fixed <- paste(CB01sunset_datehour$UTC_date, CB01sunset_datehour$sunset_UTC_hour, sep = " ")
CB01sunset_datehour$UTC_fixed = as.POSIXct(CB01sunset_datehour$UTC_fixed, format = "%Y-%m-%d %H")

CB01_sunset <- CB01_OL %>%
  right_join(CB01sunset_datehour, join_by(UTC_fixed))

CB01_500Hz <- ggplot(CB01_sunset, aes(x= UTC_fixed, y= OL_500))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))
CB01_2000Hz <- ggplot(CB01_sunset, aes(x= UTC_fixed, y= OL_2000))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))

CB01_500Hz/CB01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")



#ALL INSHORE

inshore_sunsets <- DB01_sunset %>%
  full_join(ES01_sunset) %>%
  full_join(CB01_sunset)

ggplot(inshore_sunsets, aes(x= UTC_fixed, y= OL_500, color= PLATFORM))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))

ggplot(inshore_sunsets, aes(x= UTC_fixed, y= OL_2000, color= PLATFORM))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))

```
# plotting sunrise
```{r}
#DB01
DB01_location <- matrix(c(-74.82, 38.71), nrow = 1)
DB01_date_Time <- seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2024-11-08 16:00:00"), by = "1 hour")

DB01Sunrise <- sunriset(crds = DB01_location, dateTime = DB01_date_Time, direction = "sunrise", POSIXct.out = TRUE)
DB01sunrise_datehour <- DB01Sunrise %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunrise_UTC_hour = hour(time))

DB01sunrise_datehour <- DB01sunrise_datehour %>%
  group_by(UTC_date, sunrise_UTC_hour)%>%
  summarize(n = n())
DB01sunrise_datehour$sunrise_UTC_hour <- as.character(DB01sunrise_datehour$sunrise_UTC_hour)
DB01sunrise_datehour$UTC_date <- as.character(DB01sunrise_datehour$UTC_date)
DB01sunrise_datehour <- DB01sunrise_datehour[-c(3)]
DB01sunrise_datehour$UTC_fixed <- paste(DB01sunrise_datehour$UTC_date, DB01sunrise_datehour$sunrise_UTC_hour, sep = " ")
DB01sunrise_datehour$UTC_fixed = as.POSIXct(DB01sunrise_datehour$UTC_fixed, format = "%Y-%m-%d %H")


DB01_sunrise <- DB01_OL %>%
  right_join(DB01sunrise_datehour, join_by(UTC_fixed))

DB01_sunset$sun_time = "Sunset"
DB01_sunrise$sun_time = "Sunrise"
DB01_suntimes <- DB01_sunrise %>%
  full_join(DB01_sunset)

DB01_500Hz <- ggplot(DB01_suntimes, aes(x= UTC_fixed, y= OL_500, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
 # geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  ggtitle("DB01")+
  theme(legend.title= element_blank())+
  ylim(72, 135)
DB01_1000Hz <- ggplot(DB01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
 # geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)
DB01_2000Hz <- ggplot(DB01_suntimes, aes(x= UTC_fixed, y= OL_2000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
#  geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)

DB01_500Hz/DB01_1000Hz/DB01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")

  
#plot(DB01_500Hz)

#runSoundscapeExplorer(ES01_suntimes)
  
#ES01  
ES01_location <- matrix(c(-75.29, 37.69), nrow = 1)
ES01_date_Time <- seq(ymd_hms("2023-10-13 00:00:00"), ymd_hms("2024-09-29 18:00:00"), by = "1 hour")

ES01Sunrise <- sunriset(crds = ES01_location, dateTime = ES01_date_Time, direction = "sunrise", POSIXct.out = TRUE)
ES01sunrise_datehour <- ES01Sunrise %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunrise_UTC_hour = hour(time))

ES01sunrise_datehour <- ES01sunrise_datehour %>%
  group_by(UTC_date, sunrise_UTC_hour)%>%
  summarize(n = n())
ES01sunrise_datehour$sunrise_UTC_hour <- as.character(ES01sunrise_datehour$sunrise_UTC_hour)
ES01sunrise_datehour$UTC_date <- as.character(ES01sunrise_datehour$UTC_date)
ES01sunrise_datehour <- ES01sunrise_datehour[-c(3)]
ES01sunrise_datehour$UTC_fixed <- paste(ES01sunrise_datehour$UTC_date, ES01sunrise_datehour$sunrise_UTC_hour, sep = " ")
ES01sunrise_datehour$UTC_fixed = as.POSIXct(ES01sunrise_datehour$UTC_fixed, format = "%Y-%m-%d %H")


ES01_sunrise <- ES01_OL %>%
  right_join(ES01sunrise_datehour, join_by(UTC_fixed))

ES01_sunset$sun_time = "Sunset"
ES01_sunrise$sun_time = "Sunrise"
ES01_suntimes <- ES01_sunrise %>%
  full_join(ES01_sunset)  
  
ES01_500Hz <- ggplot(ES01_suntimes, aes(x= UTC_fixed, y= OL_500, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  ggtitle("ES01")+
  theme(legend.title= element_blank())+
  ylim(72, 135)
ES01_1000Hz <- ggplot(ES01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)
ES01_2000Hz <- ggplot(ES01_suntimes, aes(x= UTC_fixed, y= OL_2000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)

ES01_500Hz/ES01_1000Hz/ES01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")


#CB01
CB01_location <- matrix(c(-75.67, 36.98), nrow = 1)
CB01_date_Time <- seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2024-11-08 16:00:00"), by = "1 hour")

CB01Sunrise <- sunriset(crds = CB01_location, dateTime = CB01_date_Time, direction = "sunrise", POSIXct.out = TRUE)
CB01sunrise_datehour <- CB01Sunrise %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunrise_UTC_hour = hour(time))

CB01sunrise_datehour <- CB01sunrise_datehour %>%
  group_by(UTC_date, sunrise_UTC_hour)%>%
  summarize(n = n())
CB01sunrise_datehour$sunrise_UTC_hour <- as.character(CB01sunrise_datehour$sunrise_UTC_hour)
CB01sunrise_datehour$UTC_date <- as.character(CB01sunrise_datehour$UTC_date)
CB01sunrise_datehour <- CB01sunrise_datehour[-c(3)]
CB01sunrise_datehour$UTC_fixed <- paste(CB01sunrise_datehour$UTC_date, CB01sunrise_datehour$sunrise_UTC_hour, sep = " ")
CB01sunrise_datehour$UTC_fixed = as.POSIXct(CB01sunrise_datehour$UTC_fixed, format = "%Y-%m-%d %H")


CB01_sunrise <- CB01_OL %>%
  right_join(CB01sunrise_datehour, join_by(UTC_fixed))

CB01_sunset$sun_time = "Sunset"
CB01_sunrise$sun_time = "Sunrise"
CB01_suntimes <- CB01_sunrise %>%
  full_join(CB01_sunset)  
  
CB01_500Hz <- ggplot(CB01_suntimes, aes(x= UTC_fixed, y= OL_500, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  ggtitle("CB01")+
  theme(legend.title= element_blank())+
  ylim(72, 135)
CB01_1000Hz <- ggplot(CB01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)
CB01_2000Hz <- ggplot(CB01_suntimes, aes(x= UTC_fixed, y= OL_2000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)

CB01_500Hz/CB01_1000Hz/CB01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")

#by groupings
DB01_500Hz/ES01_500Hz/CB01_500Hz+plot_layout(guides = "collect", axis_titles = "collect")

```
#ES01
```{r}
#ES01
ES01_location <- matrix(c(-75.29, 37.69), nrow = 1)
ES01_date_Time <- seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2024-11-08 16:00:00"), by = "1 hour")

ES01Sunrise <- sunriset(crds = ES01_location, dateTime = ES01_date_Time, direction = "sunrise", POSIXct.out = TRUE)
ES01sunrise_datehour <- ES01Sunrise %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunrise_UTC_hour = hour(time))

ES01sunrise_datehour <- ES01sunrise_datehour %>%
  group_by(UTC_date, sunrise_UTC_hour)%>%
  summarize(n = n())
ES01sunrise_datehour$sunrise_UTC_hour <- as.character(ES01sunrise_datehour$sunrise_UTC_hour)
ES01sunrise_datehour$UTC_date <- as.character(ES01sunrise_datehour$UTC_date)
ES01sunrise_datehour <- ES01sunrise_datehour[-c(3)]
ES01sunrise_datehour$UTC_fixed <- paste(ES01sunrise_datehour$UTC_date, ES01sunrise_datehour$sunrise_UTC_hour, sep = " ")
ES01sunrise_datehour$UTC_fixed = as.POSIXct(ES01sunrise_datehour$UTC_fixed, format = "%Y-%m-%d %H")

ES01_sunrise <- ES01_OL %>%
  right_join(ES01sunrise_datehour, join_by(UTC_fixed))

ES01_sunset$sun_time = "Sunset"
ES01_sunrise$sun_time = "Sunrise"
ES01_suntimes <- ES01_sunrise %>%
  full_join(ES01_sunset)

ES01_500Hz <- ggplot(ES01_suntimes, aes(x= UTC_fixed, y= OL_500, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
 # geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  ggtitle("ES01")+
  theme(legend.title= element_blank())+
  ylim(72, 135)
ES01_1000Hz <- ggplot(ES01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
 # geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)
ES01_2000Hz <- ggplot(ES01_suntimes, aes(x= UTC_fixed, y= OL_2000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
#  geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)

ES01_500Hz/ES01_1000Hz/ES01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")


```
#CB01 and combining
```{r}
#CB01
CB01_location <- matrix(c(-75.67, 36.98), nrow = 1)
CB01_date_Time <- seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2024-11-08 16:00:00"), by = "1 hour")

CB01Sunrise <- sunriset(crds = CB01_location, dateTime = CB01_date_Time, direction = "sunrise", POSIXct.out = TRUE)
CB01sunrise_datehour <- CB01Sunrise %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunrise_UTC_hour = hour(time))

CB01sunrise_datehour <- CB01sunrise_datehour %>%
  group_by(UTC_date, sunrise_UTC_hour)%>%
  summarize(n = n())
CB01sunrise_datehour$sunrise_UTC_hour <- as.character(CB01sunrise_datehour$sunrise_UTC_hour)
CB01sunrise_datehour$UTC_date <- as.character(CB01sunrise_datehour$UTC_date)
CB01sunrise_datehour <- CB01sunrise_datehour[-c(3)]
CB01sunrise_datehour$UTC_fixed <- paste(CB01sunrise_datehour$UTC_date, CB01sunrise_datehour$sunrise_UTC_hour, sep = " ")
CB01sunrise_datehour$UTC_fixed = as.POSIXct(CB01sunrise_datehour$UTC_fixed, format = "%Y-%m-%d %H")

CB01_sunrise <- CB01_OL %>%
  right_join(CB01sunrise_datehour, join_by(UTC_fixed))

CB01_sunset$sun_time = "Sunset"
CB01_sunrise$sun_time = "Sunrise"
CB01_suntimes <- CB01_sunrise %>%
  full_join(CB01_sunset)

CB01_500Hz <- ggplot(CB01_suntimes, aes(x= UTC_fixed, y= OL_500, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
 # geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  ggtitle("CB01")+
  theme(legend.title= element_blank())+
  ylim(72, 135)
CB01_1000Hz <- ggplot(CB01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
 # geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)
CB01_2000Hz <- ggplot(CB01_suntimes, aes(x= UTC_fixed, y= OL_2000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz OL SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")+
#  geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ylim(72, 135)

CB01_500Hz/CB01_1000Hz/CB01_2000Hz +plot_layout(guides = "collect", axis_titles = "collect")


###

DB01_2000Hz/ES01_2000Hz/CB01_2000Hz +plot_layout(guides= "collect", axis_titles= "collect")


CB01_1000Hz <- ggplot(CB01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "2 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
#  geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ggtitle("CB01")+
  ylim(72, 135)

DB01_1000Hz <- ggplot(DB01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "2 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
#  geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ggtitle("DB01")+
  ylim(72, 135)

ES01_1000Hz <- ggplot(ES01_suntimes, aes(x= UTC_fixed, y= OL_1000, color= sun_time))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "2 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
#  geom_smooth(aes(group=1,2))+
  scale_color_manual(values= c("#00308790", "#B7130090"))+
  theme(legend.title= element_blank())+
  ggtitle("ES01")+
  ylim(72, 135)

DB01_1000Hz/ES01_1000Hz/CB01_1000Hz +plot_layout(guides= "collect", axis_titles= "collect")


```
#open air package
```{r}
#smoothing plot using openair

colnames(CB01_OL)[17] <- "date"
colnames(DB01_OLtemps_daily)[1] <- "date"
colnames(ES01_OL)[17] <- "date"
ES01_OL <- ES01_OL[complete.cases(ES01_OL), ]
CB01_OL <- CB01_OL[complete.cases(CB01_OL), ]
DB01_OL <- DB01_OL[complete.cases(DB01_OL), ]

DB01_plot = timePlot(DB01_OLTemps, type= "PLATFORM", pollutant= c("OL_500", "OL_2000"), avg.time= "5 day", y.relation = "free", smooth= FALSE, date.format = "%b-%Y", ylab = (expression(paste("Octave Band SPL (dB re \u00b5Pa" ^ "2", "/Hz)"))))

DB01_tempPlot = timePlot(DB01_OLTemps, type= "PLATFORM", pollutant= c("OL_500", "OL_2000", "Internal_temp_C"), y.relation = "free", avg.time= "week", date.format= "%b-%Y")

plot(DB01_plot/DB01_tempPlot) #+plot_layout(axes = "collect", guides= "collect")




ES01_plot <- timePlot(ES01_OL, type= "PLATFORM", pollutant= c("OL_500", "OL_2000"), avg.time= "week", y.relation = "same", smooth= FALSE, date.format = "%b-%Y", ylab = (expression(paste("Octave Band SPL (dB re \u00b5Pa" ^ "2", "/Hz)"))))

CB01_plot <- timePlot(CB01_OL, type= "PLATFORM", pollutant= c("OL_500", "OL_2000"), avg.time= "week", y.relation = "same", smooth= FALSE, date.format = "%b-%Y", ylab = (expression(paste("Octave Band SPL (dB re \u00b5Pa" ^ "2", "/Hz)"))))




ES01_extraTime <- seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2023-10-13 20:00:00"), by = "1 hour")
ES01_extraTime <- data.frame(date= ES01_extraTime)
ES01_OL <- ES01_OL %>%
 full_join(ES01_extraTime)



smoothTrend(DB01_OL, pollutant = c("OL_500", "OL_1000", "OL_2000"), statistics= "percentile", percentile = c(95), shade= "transparent", ci= FALSE, ylab = (expression(paste("500 Hz Octave Band SPL (dB re \u00b5Pa" ^ "2", "/Hz)"))), main = "DB01")

calendarPlot(DB01_OL, pollutant= "OL_500", year = "2023", annotate= "value")

DB_dates <- DB02_OL %>%
  group_by(date)%>%
  summarize(total = n())

```
#OL_500 Delaware
```{r}
#make more data so DB03 starts at same time
subset_OL_DB03 <- seq(ymd_hms("2022-07-07 00:00:00"), ymd_hms("2023-01-10 23:00:00"), by = "1 hour")
subset_OL_DB03 <- data.frame(UTC= subset_OL_DB03)
DB03_OL <- DB03_OL%>%
  full_join(subset_OL_DB03, by= join_by(UTC))

DB01_OL_plot<- ggplot(DB01_OL, aes(x= UTC, y= OL_500))+
  geom_line()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  ylim(72, 140)+
  annotate("text", x= as.POSIXct("2022-07-10 00:00"), y= 135, label= "DB01", color= "black", size= 5)+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))

DB02_OL_plot <- ggplot(DB02_OL, aes(x= UTC, y= OL_500))+
  geom_line()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  ylim(72, 140)+
  annotate("text", x= as.POSIXct("2022-07-10 00:00"), y= 135, label= "DB02", color= "black", size= 5)+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))

DB03_OL_plot <- ggplot(DB03_OL, aes(x= UTC, y= OL_500))+
  geom_line()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  ylim(72, 140)+
  annotate("text", x= as.POSIXct("2022-07-10 00:00"), y= 135, label= "DB03", color= "black", size= 5)+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))

DB01_OL_plot/DB02_OL_plot/DB03_OL_plot + plot_layout(axis_titles = "collect", guides = "collect", design = "AA\nBB\nCC")

```
#OL_2000 Delaware
```{r}

#make more data so DB03 starts at same time
subset_OL_DB03 <- seq(ymd_hms("2022-07-07 00:00:00"), ymd_hms("2023-01-10 23:00:00"), by = "1 hour")
subset_OL_DB03 <- data.frame(UTC= subset_OL_DB03)
DB03_OL <- DB03_OL%>%
  full_join(subset_OL_DB03, by= join_by(UTC))

DB01_2000OL_plot<- ggplot(DB01_OL, aes(x= UTC, y= OL_2000))+
  geom_line()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  ylim(72, 140)+
  annotate("text", x= as.POSIXct("2022-07-10 00:00"), y= 135, label= "DB01", color= "black", size= 5)+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))

DB02_2000OL_plot <- ggplot(DB02_OL, aes(x= UTC, y= OL_2000))+
  geom_line()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  ylim(72, 140)+
  annotate("text", x= as.POSIXct("2022-07-10 00:00"), y= 135, label= "DB02", color= "black", size= 5)+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))

DB03_2000OL_plot <- ggplot(DB03_OL, aes(x= UTC, y= OL_2000))+
  geom_line()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  ylim(72, 140)+
  annotate("text", x= as.POSIXct("2022-07-10 00:00"), y= 135, label= "DB03", color= "black", size= 5)+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))

DB01_2000OL_plot/DB02_2000OL_plot/DB03_2000OL_plot + plot_layout(axis_titles = "collect", guides = "collect", design = "AA\nBB\nCC")


```
## DELAWARE BAY- mostly OL
```{r}
## OL BANDS
#DB01
DB01_OL <- read.csv("Z:/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/OL/DB01_OL.csv")
DB01_OL <- DB01_OL[-c(1)]
DB01_OL$UTC <- as.POSIXct(DB01_OL$UTC, format= "%m/%d/%Y %H", tz = "GMT")

#DB02
DB02_OL <- read.csv("Z:/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB02/OL/DB02_OL.csv")
DB02_OL$UTC <- as.POSIXct(DB02_OL$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

#DB03
DB03_OL <- read.csv("Z:/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB03/OL/DB03_OL_missing2022.csv")
DB03_OL$UTC <- as.POSIXct(DB03_OL$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")


## HMD FULL FILES

#DB01
DB01_202306_Folder <- paste0("/home/asmith/PassiveAcoustics/DETECTOR_OUTPUT/PYTHON_SOUNDSCAPE_PYPAM/Raw/NEFSC_DE/NEFSC_DE_202306_DB01/NC")
DB01_202306_Files <- list.files(DB01_202306_Folder, pattern='nc$', full.names=TRUE)
DB01_202306_HMD = loadSoundscapeData(DB01_202306_Files, timeBin = "1hour")


write_csv(DB01_202306_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "DB01_202306_HMD.csv")) #saving to personal folder, then need to switch to server so everything is together

DB03 <- DB03_202301%>%
  full_join(DB03_202306)%>%
  full_join(DB03_202311)%>%
  full_join(DB03_202405)
DB01_202207 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/HMD/202207_DB01.csv")

```
## EASTERN SEABOARD
```{r}

## HMD FULL FILES
#ES01
ES01_202310_Folder <- paste0("/home/asmith/PassiveAcoustics/DETECTOR_OUTPUT/PYTHON_SOUNDSCAPE_PYPAM/Raw/NEFSC_VA/NEFSC_VA_202310_ES01/NC")
ES01_202310_Files <- list.files(ES01_202310_Folder, pattern='nc$', full.names=TRUE)
ES01_202310_HMD = loadSoundscapeData(ES01_202310_Files, timeBin = "1hour")

write_csv(ES01_202310_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "ES01_202310.csv"))

#ES02
ES02_202310_Folder <- paste0("/home/asmith/PassiveAcoustics/DETECTOR_OUTPUT/PYTHON_SOUNDSCAPE_PYPAM/Raw/NEFSC_VA/NEFSC_VA_202310_ES02/NC")
ES02_202310_Files <- list.files(ES02_202310_Folder, pattern='nc$', full.names=TRUE)
ES02_202310_HMD = loadSoundscapeData(ES02_202310_Files, timeBin = "1hour")

write_csv(ES02_202310_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "ES02_202310.csv"))

#ES03
ES03_202310_Folder <- paste0("/home/asmith/PassiveAcoustics/DETECTOR_OUTPUT/PYTHON_SOUNDSCAPE_PYPAM/Raw/NEFSC_VA/NEFSC_VA_202310_ES03/NC")
ES03_202310_Files <- list.files(ES03_202310_Folder, pattern='nc$', full.names=TRUE)
ES03_202310_HMD = loadSoundscapeData(ES03_202310_Files, timeBin = "1hour")

write_csv(ES03_202310_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "ES03_202310.csv"))

```
## CHESAPEAKE BAY
```{r}
## HMD FULL FILES
#CB01
CB01_202212_Folder <- paste0("/home/asmith/PassiveAcoustics/DETECTOR_OUTPUT/PYTHON_SOUNDSCAPE_PYPAM/Raw/NEFSC_VA/NEFSC_VA_202212_CB01/NC")
CB01_202212_Files <- list.files(CB01_202212_Folder, pattern='nc$', full.names=TRUE)
CB01_202212_HMD = loadSoundscapeData(CB01_202212_Files, timeBin = "1hour")


write_csv(CB01_202212_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "CB01_202212.csv"))

#CB03
CB03_202311_Folder <- paste0("/home/asmith/PassiveAcoustics/DETECTOR_OUTPUT/PYTHON_SOUNDSCAPE_PYPAM/Raw/NEFSC_VA/NEFSC_VA_202311_CB01/NC")
CB03_202311_Files <- list.files(CB03_202311_Folder, pattern='nc$', full.names=TRUE)
CB03_202311_HMD = loadSoundscapeData(CB03_202311_Files, timeBin = "1hour")


write_csv(CB03_202311_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "CB03_202311.csv"))

```
## LOADING IN ALL HMD FILES- DB
```{r}
#DB01
DB01_202207 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/HMD/202207_DB01.csv")
DB01_202207$UTC <- as.POSIXct(DB01_202207$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB01_202301 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/HMD/202301_DB01.csv")
DB01_202301$UTC <- as.POSIXct(DB01_202301$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB01_202306 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/HMD/202306_DB01.csv")
DB01_202306$UTC <- as.POSIXct(DB01_202306$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB01_202311 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/HMD/202311_DB01.csv")
DB01_202311$UTC <- as.POSIXct(DB01_202311$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB01_202405 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/HMD/202405_DB01.csv")
DB01_202405$UTC <- as.POSIXct(DB01_202405$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

DB01_HMD <- DB01_202207 %>%
  full_join(DB01_202301)%>%
  full_join(DB01_202306)%>%
  full_join(DB01_202311)%>%
  full_join(DB01_202405)
write_csv(DB01_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "DB01_HMD.csv"))

DB01_HMD <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB01/HMD/DB01_HMD.csv")

#DB02
DB02_202207 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB02/HMD/202207_DB02.csv")
DB02_202207$UTC <- as.POSIXct(DB02_202207$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB02_202301 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB02/HMD/202301_DB02.csv")
DB02_202301$UTC <- as.POSIXct(DB02_202301$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB02_202306 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB02/HMD/202306_DB02.csv")
DB02_202306$UTC <- as.POSIXct(DB02_202306$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB02_202311 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB02/HMD/202311_DB02.csv")
DB02_202311$UTC <- as.POSIXct(DB02_202311$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB02_202405 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB02/HMD/202405_DB02.csv")
DB02_202405$UTC <- as.POSIXct(DB02_202405$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

DB02_HMD <- DB02_202207 %>%
  full_join(DB02_202301)%>%
  full_join(DB02_202306)%>%
  full_join(DB02_202311)%>%
  full_join(DB02_202405)

write_csv(DB02_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "DB02_HMD.csv"))


#DB03
DB03_202207 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB03/HMD/202207_DB03.csv")
DB03_202207$UTC <- as.POSIXct(DB03_202207$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB03_202301 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB03/HMD/202301_DB03.csv")
DB03_202301$UTC <- as.POSIXct(DB03_202301$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB03_202306 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB03/HMD/202306_DB03.csv")
DB03_202306$UTC <- as.POSIXct(DB03_202306$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB03_202311 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB03/HMD/202311_DB03.csv")
DB03_202311$UTC <- as.POSIXct(DB03_202311$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
DB03_202405 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/DB03/HMD/202405_DB03.csv")
DB03_202405$UTC <- as.POSIXct(DB03_202405$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

DB03_HMD <- DB03_202207 %>%
  full_join(DB03_202301)%>%
  full_join(DB03_202306)%>%
  full_join(DB03_202311)%>%
  full_join(DB03_202405)

write_csv(DB03_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "DB03_HMD.csv"))

```
## LOADING IN ALL HMD FILES- ES
```{r}

#ES01
ES01_202310 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/ES01/HMD/202310_ES01.csv")
ES01_202310$UTC <- as.POSIXct(ES01_202310$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
ES01_202404 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/ES01/HMD/202404_ES01.csv")
ES01_202404$UTC <- as.POSIXct(ES01_202404$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

ES01_HMD <- ES01_202310 %>%
  full_join(ES01_202404)

write_csv(ES01_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "ES01_HMD.csv"))

#ES02
ES02_202310 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/ES02/HMD/202310_ES02.csv")
ES02_202310$UTC <- as.POSIXct(ES02_202310$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
ES02_202404 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/ES02/HMD/202404_ES02.csv")
ES02_202404$UTC <- as.POSIXct(ES02_202404$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

ES02_HMD <- ES02_202310 %>%
  full_join(ES02_202404)

write_csv(ES02_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "ES02_HMD.csv"))

#ES03
ES03_202310 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/ES03/HMD/202310_ES03.csv")
ES03_202310$UTC <- as.POSIXct(ES03_202310$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
ES03_202404 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/ES03/HMD/202404_ES03.csv")
ES03_202404$UTC <- as.POSIXct(ES03_202404$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

ES03_HMD <- ES03_202310 %>%
  full_join(ES03_202404)

write_csv(ES03_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "ES03_HMD.csv"))

```
## LOADING IN ALL HMD FILES- CB
```{r}
#CB01

CB01_202206 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB01/HMD/202206_CB01.csv")
CB01_202206$UTC <- as.POSIXct(CB01_202206$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB01_202212 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB01/HMD/202212_CB01.csv")
CB01_202212$UTC <- as.POSIXct(CB01_202212$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB01_202306 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB01/HMD/202306_CB01.csv")
CB01_202306$UTC <- as.POSIXct(CB01_202306$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB01_202311 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB01/HMD/202311_CB01.csv")
CB01_202311$UTC <- as.POSIXct(CB01_202311$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB01_202405 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB01/HMD/202405_CB01.csv")
CB01_202405$UTC <- as.POSIXct(CB01_202405$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

CB01_HMD <- CB01_202206 %>%
  full_join(CB01_202212)%>%
  full_join(CB01_202306)%>%
  full_join(CB01_202311)%>%
  full_join(CB01_202405)
write_csv(CB01_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "CB01_HMD.csv"))

#CB02

CB02_202206 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB02/HMD/202206_CB02.csv")
CB02_202206$UTC <- as.POSIXct(CB02_202206$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB02_202306 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB02/HMD/202306_CB02.csv")
CB02_202306$UTC <- as.POSIXct(CB01_202306$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB02_202311 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB02/HMD/202311_CB02.csv")
CB02_202311$UTC <- as.POSIXct(CB02_202311$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB02_202405 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB02/HMD/202405_CB02.csv")
CB02_202405$UTC <- as.POSIXct(CB02_202405$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

CB02_HMD <- CB02_202206 %>%
  full_join(CB02_202306)%>%
  full_join(CB02_202311)%>%
  full_join(CB02_202405)
write_csv(CB02_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "CB02_HMD.csv"))

#CB03

CB03_202206 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB03/HMD/202206_CB03.csv")
CB03_202206$UTC <- as.POSIXct(CB03_202206$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB03_202212 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB03/HMD/202212_CB03.csv")
CB03_202212$UTC <- as.POSIXct(CB03_202212$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB03_202306 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB03/HMD/202306_CB03.csv")
CB03_202306$UTC <- as.POSIXct(CB03_202306$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB03_202311 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB03/HMD/202311_CB03.csv")
CB03_202311$UTC <- as.POSIXct(CB03_202311$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")
CB03_202405 <- read.csv("/home/asmith/PassiveAcoustics/DATA_ANALYSIS/PUBLICATIONS/MANUSCRIPTS/Smith-et-al_TBD-Mid-Atl-Soundscapes/Output_Files_and_Results/CB03/HMD/202405_CB03.csv")
CB03_202405$UTC <- as.POSIXct(CB03_202405$UTC, format= "%Y-%m-%dT%H:%M:%SZ", tz = "GMT")

CB03_HMD <- CB03_202206 %>%
  full_join(CB03_202212)%>%
  full_join(CB03_202306)%>%
  full_join(CB03_202311)%>%
  full_join(CB03_202405)

write.csv(CB03_HMD, file = paste0("/home/asmith/Anne.Smith/GitHub/Mid_Atl_Soundscape/data", "CB03_HMD.csv"))



```
#testing area
```{r}
#wind stuff
ES03_HMD <- matchGFS(ES03_HMD)
ES03_HMD$windCategory <- cut(ES03_HMD$windMag, breaks=c(0, 8, 20, 100),
                                  labels=c('Low Wind', 'Medium Wind', 'High Wind'))
runSoundscapeExplorer(DB01_HMD)

#finding max SPL from TOL

max_TOLs <- melted_all_TOLSiteSeason %>%
  group_by(PLATFORM, season)%>%
  summarise(Value= max(med_seasonal_SPL))
df <- tapply(melted_all_TOLSiteSeason$med_seasonal_SPL, list(melted_all_TOLSiteSeason$PLATFORM, melted_all_TOLSiteSeason$TOL_band), max, na.rm=TRUE)

print(df)

#broadband stuff

all_BB <- createOctaveLevel(all_sites, type= 'bb', freqRange= c(20, 23961), normalized= TRUE)

ggplot(all_BB, aes(x= UTC, y =`BB_20-23961`))+
  geom_line()+
  facet_wrap(factor(PLATFORM, levels = c('DB01', 'DB02', 'DB03', 'ES01', 'ES02', 'ES03', 'CB01', 'CB02', 'CB03'))~., ncol= 3)+
  theme_bw()

#peaks on SPL
local_maximas <- DB01_envData_daily[which(diff(sign(diff(DB01_envData_daily$med_500)))==-2)+1,]
top2 <- tail(local_maximas[order(local_maximas$med_500),],2)
DB01_envData_daily$label <- ifelse(DB01_envData_daily$UTC %in% top2$UTC, DB01_envData_daily$UTC, NA)
DB01_envData_daily$label <- as.Date(DB01_envData_daily$label, format= "%Y-%m-%d", tz = "GMT")


#temps combo
DB01_temps$site <- "DB01"
ES01_temps$site <- "ES01"
CB01_temps$site <- "CB01"
all_site_temps <- DB01_temps %>%
  full_join(ES01_temps) %>%
  full_join(CB01_temps)

all_site_temps$site = factor(all_site_temps$site,
                                        levels= c('DB01', 'ES01', 'CB01'),
                                        labels= c('DB01', 'ES01', 'CB01'))

ggplot(all_site_temps, aes(x= UTC_fixed, y= Internal_temp_C, color= site))+
  geom_line()+
  theme_bw()+
  scale_x_datetime(date_breaks = "3 months", date_labels= "%b %Y", minor_breaks = NULL)+
  ggtitle("Inshore site temperatures")+
  theme(legend.title= element_blank())+
  xlab("Date")+
  ylab("Daily Median Temperature (°C)")
  
all_site_temps$month <- month(all_site_temps$UTC_fixed) ##this dataframe is in the OL files combining "inshore/offshore grouping" section

all_site_temps$season = case_when(all_site_temps$month == 1 ~ "winter",
                            all_site_temps$month == 2 ~ "winter",
                            all_site_temps$month == 3 ~ "spring",
                            all_site_temps$month == 4 ~ "spring",
                            all_site_temps$month == 5 ~ "spring",
                            all_site_temps$month == 6 ~ "summer",
                            all_site_temps$month == 7 ~ "summer",
                            all_site_temps$month == 8 ~ "summer",
                            all_site_temps$month == 9 ~ "fall",
                            all_site_temps$month == 10 ~ "fall",
                            all_site_temps$month == 11 ~ "fall",
                            all_site_temps$month == 12 ~ "winter")
boxplot(Internal_temp_C ~ season, data = all_site_temps, xlab= "Site", ylab= "Temp")
kruskal.test(Internal_temp_C ~ site, data = all_site_temps)


get_box_stats <- function(y, upper_limit = max(all_site_temps$Internal_temp_C) * 1.15) {
  return(data.frame(
    y = 0.95 * upper_limit,
    label = paste(
      "Count =", length(y), "\n"
    )
  ))
}
all_site_temps <- all_site_temps %>%
  drop_na(season)

ggplot(data = all_site_temps,
       aes(x= season, y= Internal_temp_C, fill= season))+
  stat_boxplot(geom = "errorbar", width = 0.6)+
  geom_boxplot(width = 0.9)+
  stat_summary(fun.data = get_box_stats, geom = "text", hjust = 0.5, vjust = 0.5)+
  labs(x= "Site",
       y= expression(paste("Temp")))+
 # scale_x_discrete(labels = c("Winter", "Spring", "Summer", "Fall"))+
  #scale_fill_manual(values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  theme_bw()+
  facet_wrap(~site)+
  theme(axis.title= element_text(size= 12),
        axis.text= element_text(size= 11),
        legend.position= "none",
        strip.text= element_text(size= 12)
  )

```
#stats
```{r}
#two-sample ttest- change to whatever site and OL is needed

CB01_diel_shapiro <- CB01_suntimes %>%
  group_by(sun_time) %>%
  summarise(p.value= shapiro.test(OL_2000)$p.value)
print(CB01_diel_shapiro) #failed normality (p-values less than 0.05)
leveneTest(CB01_suntimes$OL_2000, CB01_suntimes$sun_time) #failed equal variances (p-value less than 0.001)

wilcox.test(OL_2000 ~ sun_time, data = CB01_suntimes)
boxplot(OL_2000 ~ sun_time, data = DB01_suntimes, xlab= "Time of day", ylab= "OL SPL")

#all sites combined

all_suntimes <- DB01_suntimes %>%
  full_join(ES01_suntimes)%>%
  full_join(CB01_suntimes)
all_suntimes <- all_suntimes %>%
  drop_na(PLATFORM, OL_500)

#two way ANOVA for OL_500 (diff between site and suntime)
all_diel_shapiro <- all_suntimes %>%
  group_by(sun_time, PLATFORM) %>%
  summarise(p.value= shapiro.test(OL_500)$p.value) #change to diff OL needed
print(all_diel_shapiro)
leveneTest(OL_500 ~sun_time*PLATFORM, data= all_suntimes)
ANOVAmodel500 <- aov(OL_500 ~ sun_time*PLATFORM, data= all_suntimes)
summary(ANOVAmodel500)
ggline(all_suntimes, x= "PLATFORM", y= "OL_500", color= "sun_time",
       add= c("mean_se"))

#if significant
tukey_500 <- TukeyHSD(ANOVAmodel500)
print(tukey_500)
tukeyGroups500 <- multcompLetters4(ANOVAmodel500, tukey_500)
print(tukeyGroups500)

summary500 <- all_suntimes %>%
  group_by(sun_time, PLATFORM) %>%
  summarise(median= median(OL_500), SE= SE(OL_500)) %>%
  arrange(desc(median))

tableTukey500 <- as.data.frame.list(tukeyGroups500$'sun_time:PLATFORM')
summary500$tukey_500 <- tableTukey500$Letters
print(summary500)

sun500.summarized = all_suntimes %>% 
  group_by(sun_time, PLATFORM) %>% 
  summarize(MaxSPL=max(OL_500))
sun500.summarized <- sun500.summarized %>%
  full_join(summary500)
sun500.summarized$PLATFORM = factor(sun500.summarized$PLATFORM,
                                        levels= c('DB01', 'ES01', 'CB01'),
                                        labels= c('DB01', 'ES01', 'CB01'))
ggplot(all_suntimes,aes(x=sun_time,y=OL_500))+
  geom_boxplot()+
  geom_text(data=sun500.summarized,aes(x=sun_time,y=1+MaxSPL, label=tukey_500),vjust=0)+
  facet_wrap(~PLATFORM)

#OL_1000
all_diel_shapiro <- all_suntimes %>%
  group_by(sun_time, PLATFORM) %>%
  summarise(p.value= shapiro.test(OL_1000)$p.value) #change to diff OL needed
print(all_diel_shapiro)
leveneTest(OL_1000 ~sun_time*PLATFORM, data= all_suntimes)
ANOVAmodel1000 <- aov(OL_1000 ~ sun_time*PLATFORM, data= all_suntimes)
summary(ANOVAmodel1000)
ggline(all_suntimes, x= "PLATFORM", y= "OL_1000", color= "sun_time",
       add= c("mean_se"))
#if significant
tukey_1000 <- TukeyHSD(ANOVAmodel1000)
print(tukey_1000)
tukeyGroups1000 <- multcompLetters4(ANOVAmodel1000, tukey_1000)
print(tukeyGroups1000)

summary1000 <- all_suntimes %>%
  group_by(sun_time, PLATFORM) %>%
  summarise(median= median(OL_1000), SE= SE(OL_1000))%>%
  arrange(desc(median))

tableTukey1000 <- as.data.frame.list(tukeyGroups1000$'sun_time:PLATFORM')
summary1000$tukey_1000 <- tableTukey1000$Letters
print(summary1000)

sun1000.summarized = all_suntimes %>% 
  group_by(sun_time, PLATFORM) %>% 
  summarize(MaxSPL=max(OL_1000)) 

sun1000.summarized <- sun1000.summarized %>%
  full_join(summary1000)
sun1000.summarized$PLATFORM = factor(sun1000.summarized$PLATFORM,
                                        levels= c('DB01', 'ES01', 'CB01'),
                                        labels= c('DB01', 'ES01', 'CB01'))
ggplot(all_suntimes,aes(x=sun_time,y=OL_1000))+
  geom_boxplot()+
  geom_text(data=sun1000.summarized,aes(x=sun_time,y=1+MaxSPL, label=tukey_1000),vjust=0)+
  facet_wrap(~PLATFORM)

#OL_2000
all_diel_shapiro <- all_suntimes %>%
  group_by(sun_time, PLATFORM) %>%
  summarise(p.value= shapiro.test(OL_2000)$p.value) #change to diff OL needed
print(all_diel_shapiro)
leveneTest(OL_2000 ~sun_time*PLATFORM, data= all_suntimes)
ANOVAmodel2000 <- aov(OL_2000 ~ sun_time*PLATFORM, data= all_suntimes)
summary(ANOVAmodel2000)
ggline(all_suntimes, x= "PLATFORM", y= "OL_2000", color= "sun_time",
       add= c("mean_se"))
#if significant
tukey_2000 <- TukeyHSD(ANOVAmodel2000)
print(tukey_2000)
tukeyGroups2000 <- multcompLetters4(ANOVAmodel2000, tukey_2000)
print(tukeyGroups2000)

summary2000 <- all_suntimes %>%
  group_by(sun_time, PLATFORM) %>%
  summarise(median= median(OL_2000), SE= SE(OL_1000))%>%
  arrange(desc(median))

tableTukey2000 <- as.data.frame.list(tukeyGroups2000$'sun_time:PLATFORM')
summary2000$tukey_2000 <- tableTukey2000$Letters
print(summary2000)

sun2000.summarized = all_suntimes %>% 
  group_by(sun_time, PLATFORM) %>% 
  summarize(MaxSPL=max(OL_2000))
sun2000.summarized <- sun2000.summarized %>%
  full_join(summary2000)
sun2000.summarized$PLATFORM = factor(sun2000.summarized$PLATFORM,
                                        levels= c('DB01', 'ES01', 'CB01'),
                                        labels= c('DB01', 'ES01', 'CB01'))
ggplot(all_suntimes,aes(x=sun_time,y=OL_2000))+
  geom_boxplot()+
  geom_text(data=sun2000.summarized,aes(x=sun_time,y=1+MaxSPL, label=tukey_2000),vjust=0)+
  facet_wrap(~PLATFORM)


#plots
all_suntimes$PLATFORM = factor(all_suntimes$PLATFORM,
                                        levels= c('DB01', 'ES01', 'CB01'),
                                        labels= c('DB01', 'ES01', 'CB01'))

get_box_stats_suntimes500 <- function(y, upper_limit = max(all_suntimes$OL_500) * 1.15) {
  return(data.frame(
    y = 0.95 * upper_limit,
    label = paste(
      "Count =", length(y), "\n"
    )
  ))
}


suntimes_500 <- ggplot(data = all_suntimes,
       aes(x= sun_time, y= OL_500, fill= sun_time))+
  stat_boxplot(geom = "errorbar", width = 0.6)+
  geom_boxplot(width = 0.9)+
  geom_text(data=sun500.summarized,aes(x=sun_time,y=1+MaxSPL, label=tukey_500),vjust=0, color= "#497381")+
  stat_summary(fun.data = get_box_stats_suntimes500, geom = "text", hjust = 0.5, vjust = 1)+
  labs(x= "Time of day",
       y= expression(paste("500Hz OL SPL")))+
  scale_x_discrete(labels = c("Sunrise", "Sunset"))+
  scale_fill_manual(values= c("#5761C0", "#DB2207"))+
  theme_bw()+
  facet_wrap(~PLATFORM)+
  theme(axis.title= element_text(size= 18),
        axis.text.y= element_text(size= 16),
        axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        legend.position= "none",
        strip.text= element_text(size= 16)
  )


get_box_stats_suntimes1000 <- function(y, upper_limit = max(all_suntimes$OL_1000) * 1.15) {
  return(data.frame(
    y = 0.95 * upper_limit,
    label = paste(
      "Count =", length(y), "\n"
    )
  ))
}



suntimes_1000 <- ggplot(data = all_suntimes,
       aes(x= sun_time, y= OL_1000, fill= sun_time))+
  stat_boxplot(geom = "errorbar", width = 0.6)+
  geom_boxplot(width = 0.9)+
  geom_text(data=sun1000.summarized,aes(x=sun_time,y=1+MaxSPL, label=tukey_1000),vjust=0, color= "orange")+
  stat_summary(fun.data = get_box_stats_suntimes1000, geom = "text", hjust = 0.5, vjust = 1)+
  labs(x= "Time of day",
       y= expression(paste("1000Hz OL SPL")))+
  scale_x_discrete(labels = c("Sunrise", "Sunset"))+
  scale_fill_manual(values= c("#5761C0", "#DB2207"))+
  theme_bw()+
  facet_wrap(~PLATFORM)+
  theme(axis.title= element_text(size= 18),
        axis.text.y= element_text(size= 16),
        axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        legend.position= "none",
        strip.text.x = element_blank(),
        strip.background = element_blank())

get_box_stats_suntimes2000 <- function(y, upper_limit = max(all_suntimes$OL_2000) * 1.15) {
  return(data.frame(
    y = 0.95 * upper_limit,
    label = paste(
      "Count =", length(y), "\n"
    )
  ))
}

suntimes_2000 <- ggplot(data = all_suntimes,
       aes(x= sun_time, y= OL_2000, fill= sun_time))+
  stat_boxplot(geom = "errorbar", width = 0.6)+
  geom_boxplot(width = 0.9)+
  geom_text(data=sun2000.summarized,aes(x=sun_time,y=1.5+MaxSPL, label=tukey_2000),vjust=0, color= "purple")+
  stat_summary(fun.data = get_box_stats_suntimes2000, geom = "text", hjust = 0.5, vjust = 1)+
  labs(x= "Time of day",
       y= expression(paste("2000Hz OL SPL")))+
  scale_x_discrete(labels = c("Sunrise", "Sunset"))+
  scale_fill_manual(values= c("#5761C0", "#DB2207"))+
  theme_bw()+
  facet_wrap(~PLATFORM)+
  theme(axis.title= element_text(size= 18),
        axis.text= element_text(size= 16),
        axis.ticks.x= element_blank(),
        legend.position= "none",
        strip.text.x = element_blank(),
        strip.background = element_blank())


sun_AllBoxplots <- suntimes_500/suntimes_1000/suntimes_2000 +plot_layout(guides = "collect", axis_titles = "collect")

plot(sun_AllBoxplots)

#ggsave(here("figs", "sun_AllBoxplots.png"), sun_AllBoxplots, width= 48, height= 32, units= "in")

#cor.test(DB01_OLTemps$OL_1000, DB01_OLTemps$Internal_temp_C, method= "kendall")

```
#seasonal temp correlation
```{r}
DB01_OLtemps_daily$month <- month(DB01_OLtemps_daily$UTC) 

DB01_OLtemps_daily$season = case_when(DB01_OLtemps_daily$month == 1 ~ "winter",
                            DB01_OLtemps_daily$month == 2 ~ "winter",
                            DB01_OLtemps_daily$month == 3 ~ "spring",
                            DB01_OLtemps_daily$month == 4 ~ "spring",
                            DB01_OLtemps_daily$month == 5 ~ "spring",
                            DB01_OLtemps_daily$month == 6 ~ "summer",
                            DB01_OLtemps_daily$month == 7 ~ "summer",
                            DB01_OLtemps_daily$month == 8 ~ "summer",
                            DB01_OLtemps_daily$month == 9 ~ "fall",
                            DB01_OLtemps_daily$month == 10 ~ "fall",
                            DB01_OLtemps_daily$month == 11 ~ "fall",
                            DB01_OLtemps_daily$month == 12 ~ "winter")
DB01_OLtemps_daily <- DB01_OLtemps_daily %>%
  drop_na(season)
DB01_OLtemps_daily$season = factor(DB01_OLtemps_daily$season,
                                        levels= c("winter", "spring", "summer", "fall"),
                                        labels= c("Winter", "Spring", "Summer", "Fall"))

ES01_OLtemps_daily$month <- month(ES01_OLtemps_daily$UTC) 
ES01_OLtemps_daily$season = case_when(ES01_OLtemps_daily$month == 1 ~ "winter",
                            ES01_OLtemps_daily$month == 2 ~ "winter",
                            ES01_OLtemps_daily$month == 3 ~ "spring",
                            ES01_OLtemps_daily$month == 4 ~ "spring",
                            ES01_OLtemps_daily$month == 5 ~ "spring",
                            ES01_OLtemps_daily$month == 6 ~ "summer",
                            ES01_OLtemps_daily$month == 7 ~ "summer",
                            ES01_OLtemps_daily$month == 8 ~ "summer",
                            ES01_OLtemps_daily$month == 9 ~ "fall",
                            ES01_OLtemps_daily$month == 10 ~ "fall",
                            ES01_OLtemps_daily$month == 11 ~ "fall",
                            ES01_OLtemps_daily$month == 12 ~ "winter")
ES01_OLtemps_daily <- ES01_OLtemps_daily %>%
  drop_na(season)
ES01_OLtemps_daily$season = factor(ES01_OLtemps_daily$season,
                                        levels= c("winter", "spring", "summer", "fall"),
                                        labels= c("Winter", "Spring", "Summer", "Fall"))

CB01_OLtemps_daily$month <- month(CB01_OLtemps_daily$UTC) 

CB01_OLtemps_daily$season = case_when(CB01_OLtemps_daily$month == 1 ~ "winter",
                            CB01_OLtemps_daily$month == 2 ~ "winter",
                            CB01_OLtemps_daily$month == 3 ~ "spring",
                            CB01_OLtemps_daily$month == 4 ~ "spring",
                            CB01_OLtemps_daily$month == 5 ~ "spring",
                            CB01_OLtemps_daily$month == 6 ~ "summer",
                            CB01_OLtemps_daily$month == 7 ~ "summer",
                            CB01_OLtemps_daily$month == 8 ~ "summer",
                            CB01_OLtemps_daily$month == 9 ~ "fall",
                            CB01_OLtemps_daily$month == 10 ~ "fall",
                            CB01_OLtemps_daily$month == 11 ~ "fall",
                            CB01_OLtemps_daily$month == 12 ~ "winter")
CB01_OLtemps_daily <- CB01_OLtemps_daily %>%
  drop_na(season)
CB01_OLtemps_daily$season = factor(CB01_OLtemps_daily$season,
                                        levels= c("winter", "spring", "summer", "fall"),
                                        labels= c("Winter", "Spring", "Summer", "Fall"))

DB01_OLtemps_daily$site <- "DB01"
ES01_OLtemps_daily$site <- "ES01"
CB01_OLtemps_daily$site <- "CB01"

all_OLTemps <- DB01_OLtemps_daily %>%
  full_join(ES01_OLtemps_daily)%>%
  full_join(CB01_OLtemps_daily)

all_OLTemps$site = factor(all_OLTemps$site,
                                        levels= c('DB01', 'ES01', 'CB01'),
                                        labels= c('DB01', 'ES01', 'CB01'))

#plotting

Corr_OL500 <- ggplot(all_OLTemps, aes(x = med_temp, y = med_500, group= season, color= season))+
  geom_point() +
  geom_smooth(method='glm', level= 0.90)+
  stat_poly_eq(formula = y ~ x, 
               aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.., sep = "*`,`~")), 
               parse = TRUE,
               label.x = "left",
               vstep = 0.05)+
  xlab("Median daily temperature (°C))")+
  ylab(expression(paste('Median 500 Hz Octave Level SPL (dB re 1 \u00b5Pa)')))+
  scale_color_manual(labels= c("Winter", "Spring", "Summer", "Fall"), values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  scale_fill_manual(values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  theme_bw()+
  guides(color= guide_legend(title= "Season"))+
  facet_wrap(~site)+
  theme(axis.title= element_text(size= 18),
        axis.text.y= element_text(size= 16),
        axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        legend.position= "none",
        strip.text= element_text(size= 16)
  )

Corr_OL1000 <- ggplot(all_OLTemps, aes(x = med_temp, y = med_1000, group= season, color= season))+
  geom_point() +
  geom_smooth(method='glm', level= 0.90)+
  stat_poly_eq(formula = y ~ x, 
               aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.., sep = "*`,`~")), 
               parse = TRUE,
               label.x = "left",
               vstep = 0.05)+
  xlab("Median daily temperature (°C))")+
  ylab(expression(paste('Median 1000 Hz Octave Level SPL (dB re 1 \u00b5Pa)')))+
  scale_color_manual(labels= c("Winter", "Spring", "Summer", "Fall"), values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  scale_fill_manual(values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  theme_bw()+
  guides(color= guide_legend(title= "Season"))+
  facet_wrap(~site)+
  theme(axis.title= element_text(size= 18),
        axis.text.y= element_text(size= 16),
        axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        legend.position= "none",
        strip.text.x = element_blank(),
        strip.background = element_blank())

Corr_OL2000 <- ggplot(all_OLTemps, aes(x = med_temp, y = med_2000, group= season, color= season))+
  geom_point() +
  geom_smooth(method='glm', level= 0.90)+
  stat_poly_eq(formula = y ~ x, 
               aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.., sep = "*`,`~")), 
               parse = TRUE,
               label.x = "left",
               vstep = 0.05)+
  xlab("Median daily temperature (°C))")+
  ylab(expression(paste('Median 2000 Hz Octave Level SPL (dB re 1 \u00b5Pa)')))+
  scale_color_manual(labels= c("Winter", "Spring", "Summer", "Fall"), values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  scale_fill_manual(values= c("#5761C0", "#4B8320", "#DB2207","#FFAB38"))+
  theme_bw()+
  guides(color= guide_legend(title= "Season"))+
  facet_wrap(~site)+
  theme(axis.title= element_text(size= 18),
        axis.text= element_text(size= 16),
        axis.ticks.x= element_blank(),
        legend.title= element_text(size= 13),
        legend.text = element_text(size= 13),
        strip.text.x = element_blank(),
        strip.background = element_blank())


corr_allOL<- Corr_OL500/Corr_OL1000/Corr_OL2000+ plot_layout(axis_titles = "collect", guides= "collect")

plot(corr_allOL)

#ggsave(here("figs", "corr_allOL.png"), corr_allOL, width= 36, height= 18, units= "in")


```
#inshore sites- minute level OL
```{r}
DB01_202207_minOL <- read.csv(here("data/DB01_202207_minOL.csv"))
DB01_202207_minOL$UTC <- as.POSIXct(DB01_202207_minOL$UTC, format= "%Y-%m-%dT%H:%M:%SZ")
DB01_202207_minOL$PLATFORM = "DB01"

DB01_202207_Folder <- paste0("//Z:/PassiveAcoustics/DETECTOR_OUTPUT/PYTHON_SOUNDSCAPE_PYPAM/Raw/NEFSC_DE/NEFSC_DE_202207_DB01/NC")
runDailyLTSAReview(DB01_202207_Folder)

ES01_202404_minOL <- read.csv(here("data/ES01_202404_min.csv"))
ES01_202404_minOL$UTC <- as.POSIXct(ES01_202404_minOL$UTC, format= "%Y-%m-%dT%H:%M:%SZ")
ES01_202404_minOL$PLATFORM = "ES01"

CB01_202206_minOL <- read.csv(here("data/CB01_202206_min.csv"))
CB01_202206_minOL$UTC <- as.POSIXct(CB01_202206_minOL$UTC, format= "%Y-%m-%dT%H:%M:%SZ")
CB01_202206_minOL$PLATFORM = "CB01"
```
#minute-level sunset OL full deployment
```{r}
DB01_minlocation <- matrix(c(-74.82, 38.71), nrow = 1)
DB01_mindate_Time <- seq(ymd_hms("2022-07-07 00:00:00"), ymd_hms("2022-12-16 17:44:00"), by = "1 min")

DB01_minSunset <- sunriset(crds = DB01_minlocation, dateTime = DB01_mindate_Time, direction = "sunset", POSIXct.out = TRUE)
DB01sunset_datehourmin <- DB01_minSunset %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunset_UTC_hour = hour(time))%>%
  mutate(sunset_UTC_minute = minute(time))
DB01sunset_datehourmin <- DB01sunset_datehourmin %>%
  group_by(UTC_date, sunset_UTC_hour, sunset_UTC_minute)%>%
  summarize(n = n())
DB01sunset_datehourmin$sunset_UTC_hour <- as.character(DB01sunset_datehourmin$sunset_UTC_hour)
DB01sunset_datehourmin$sunset_UTC_minute <- as.character(DB01sunset_datehourmin$sunset_UTC_minute)
DB01sunset_datehourmin$UTC_date <- as.character(DB01sunset_datehourmin$UTC_date)
DB01sunset_datehourmin <- DB01sunset_datehourmin[-c(4)]
DB01sunset_datehourmin$UTC_1 <- paste(DB01sunset_datehourmin$UTC_date, DB01sunset_datehourmin$sunset_UTC_hour, sep = " ")
DB01sunset_datehourmin$UTC <- paste(DB01sunset_datehourmin$UTC_1,DB01sunset_datehourmin$sunset_UTC_minute , sep = ":")
DB01sunset_datehourmin$UTC = as.POSIXct(DB01sunset_datehourmin$UTC, format = "%Y-%m-%d %H:%M")

DB01_minSunsetTimes <- DB01_202207_minOL %>%
  right_join(DB01sunset_datehourmin, join_by(UTC))

DB01_min500Hz <- ggplot(DB01_minSunsetTimes, aes(x= UTC, y= OL_500))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%m/%d", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")
DB01_min1000Hz <- ggplot(DB01_minSunsetTimes, aes(x= UTC, y= OL_1000))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%m/%d", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")
DB01_min2000Hz <- ggplot(DB01_minSunsetTimes, aes(x= UTC, y= OL_2000))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%m/%d", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")

DB01_min500Hz/DB01_min1000Hz/DB01_min2000Hz +plot_layout(guides = "collect", axis_titles = "collect")

#CB01
CB01_minlocation <- matrix(c(-75.67, 36.98), nrow = 1)
CB01_mindate_Time <- seq(ymd_hms("2022-07-07 00:00:00"), ymd_hms("2022-12-16 17:44:00"), by = "1 min")
CB01_minSunset <- sunriset(crds = CB01_minlocation, dateTime = CB01_mindate_Time, direction = "sunset", POSIXct.out = TRUE)
CB01sunset_datehourmin <- CB01_minSunset %>%
  mutate(UTC_date = date(time))%>%
  mutate(sunset_UTC_hour = hour(time))%>%
  mutate(sunset_UTC_minute = minute(time))
CB01sunset_datehourmin <- CB01sunset_datehourmin %>%
  group_by(UTC_date, sunset_UTC_hour, sunset_UTC_minute)%>%
  summarize(n = n())
CB01sunset_datehourmin$sunset_UTC_hour <- as.character(CB01sunset_datehourmin$sunset_UTC_hour)
CB01sunset_datehourmin$sunset_UTC_minute <- as.character(CB01sunset_datehourmin$sunset_UTC_minute)
CB01sunset_datehourmin$UTC_date <- as.character(CB01sunset_datehourmin$UTC_date)
CB01sunset_datehourmin <- CB01sunset_datehourmin[-c(4)]
CB01sunset_datehourmin$UTC_1 <- paste(CB01sunset_datehourmin$UTC_date, CB01sunset_datehourmin$sunset_UTC_hour, sep = " ")
CB01sunset_datehourmin$UTC <- paste(CB01sunset_datehourmin$UTC_1,CB01sunset_datehourmin$sunset_UTC_minute , sep = ":")
CB01sunset_datehourmin$UTC = as.POSIXct(CB01sunset_datehourmin$UTC, format = "%Y-%m-%d %H:%M")
CB01_minSunsetTimes <- CB01_202206_minOL %>%
  right_join(CB01sunset_datehourmin, join_by(UTC))
CB01_min500Hz <- ggplot(CB01_minSunsetTimes, aes(x= UTC, y= OL_500))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")
CB01_min1000Hz <- ggplot(CB01_minSunsetTimes, aes(x= UTC, y= OL_1000))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")
CB01_min2000Hz <- ggplot(CB01_minSunsetTimes, aes(x= UTC, y= OL_2000))+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%b %Y", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  geom_hline(yintercept = 100, col= "black")

CB01_min500Hz/CB01_min1000Hz/CB01_min2000Hz +plot_layout(guides = "collect", axis_titles = "collect")


#fix below
ES01_location <- matrix(c(-75.29, 37.69), nrow = 1)
ES01_date_Time <- seq(ymd_hms("2023-10-13 00:00:00"), ymd_hms("2024-09-29 18:00:00"), by = "1 hour")

```
#one week minute level SPL
```{r}
DB01subset_0916_0923 <-  seq(ymd_hms("2022-09-16 04:00:00"), ymd_hms("2022-09-24 04:00:00"), by = "1 min")

DB01subset_0916_0923 <- data.frame(UTC= DB01subset_0916_0923)
DB01join_0916_0923 <- DB01_202207_minOL %>%
  semi_join(DB01subset_0916_0923, by= join_by(UTC))

DB01join_0916_0923 <- DB01join_0916_0923 %>%
  mutate(UTC_date = date(UTC))

DB01join_500_max <- DB01join_0916_0923 %>%
   group_by(UTC_date,
            UTC >= "2022-09-20 00:00",
            UTC < "2022-09-19 23:50") %>%
   slice(which.max(OL_500))
DB01join_500_max <- DB01join_500_max [-c(5:8, 10:16)]

DB_500 <- ggplot(DB01join_0916_0923, aes(x= UTC, y= OL_500))+
  geom_daynight(sunrise= 11, sunset= 23)+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "1 day", date_labels= "%m/%d", minor_breaks = NULL)+
  theme_bw()+
#  xlab("Date (UTC)")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  ggtitle("DB01 2022")+
  annotate(geom= "text", x=as.POSIXct("2022-09-20 23:59:00"), y= 136.0901, label = "23:59", color= "red", size= 4)+
#  annotate(geom= "point", x=as.POSIXct("2022-09-21 00:00:00"), y= 135.0280, color= "green", size= 1)+
  annotate(geom= "text", x=as.POSIXct("2022-09-22 00:00:00"), y= 134.2585, label= "00:00", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-23 00:05:00"), y= 132.7967, label= "00:05", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-18 23:47:00"), y= 132.5401, label= "23:47", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-19 23:55:00"), y= 132.1972, label= "23:55", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-17 23:57:00"), y= 128.0715, label= "23:57",  color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-16 23:59:00"), y= 126.8383, label= "23:59", color= "red", size= 4)+
#  annotate(geom= "text", x=as.POSIXct("2022-09-24 00:00:00"), y= 131.6342, label= "00:00", color= "red", size= 4)+
  ylim(90, 137)+
  theme(axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        axis.title.x= element_blank())

plot(DB_500)

CB01subset_0916_0923 <-  seq(ymd_hms("2022-09-16 04:00:00"), ymd_hms("2022-09-24 04:00:00"), by = "1 min")

CB01subset_0916_0923 <- data.frame(UTC= CB01subset_0916_0923)
CB01join_0916_0923 <- CB01_202206_minOL %>%
  semi_join(CB01subset_0916_0923, by= join_by(UTC))

CB01join_0916_0923 <- CB01join_0916_0923 %>%
  mutate(UTC_date = date(UTC))

CB01join_500_max <- CB01join_0916_0923 %>%
   group_by(UTC_date) %>%
   slice(which.max(OL_500))
CB01join_500_max <- CB01join_500_max [-c(5:8, 10:16)]

CB_500<- ggplot(CB01join_0916_0923, aes(x= UTC, y= OL_500))+
  geom_daynight(sunrise= 11, sunset= 23)+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "1 day", date_labels= "%m/%d", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date (UTC)")+
  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  ggtitle("CB01 2022")+
  ylim(90, 137)+
  annotate(geom= "text", x=as.POSIXct("2022-09-16 03:10:00"), y= 130.4991, label = "03:10", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-17 17:38:00"), y= 129.4855, label = "17:38", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-18 03:17:00"), y= 130.1897, label = "03:17", color= "red", size= 4)+
#  annotate(geom= "text", x=as.POSIXct("2022-09-19 23:58:00"), y= 127.3293, label = "23:58", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-20 00:34:00"), y= 129.5519, label = "00:34", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-21 00:38:00"), y= 131.2127, label = "00:38", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-22 23:56:00"), y= 130.2560, label = "23:56", color= "red", size= 4)+
  annotate(geom= "text", x=as.POSIXct("2022-09-23 04:57:00"), y= 133.6289, label = "04:57", color= "red", size= 4)

#lims <- as.POSIXct(strptime(c("2022-09-17 00:00:00", "2022-09-17 23:59:59"),
#                            format= "%Y-%m-%d %H:%M:%S"))

#ggplot(CB01join_0916_0923, aes(x= UTC, y= OL_1000))+
#  geom_daynight(sunrise= 11, sunset= 23)+
#  geom_line(linewidth = 0.75)+
#  scale_x_datetime(date_breaks = "5 hours", date_labels= "%H:%M", minor_breaks = NULL,
#                   limits= lims)+
#  theme_bw()+
#  xlab("Date (UTC)")+
#  ylab(expression(paste('Median 500Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
#  ggtitle("CB01 2022")+
#  ylim(90, 137)

#runSoundscapeExplorer(CB01join_0916_0923)

plot(CB_500)

DB_500/CB_500 + plot_layout(guides= "collect", axis_titles = "collect")

DB_2000 <- ggplot(DB01join_0916_0923, aes(x= UTC, y= OL_2000))+
  geom_daynight(sunrise= 11, sunset= 23)+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "1 day", date_labels= "%m/%d", minor_breaks = NULL)+
  theme_bw()+
#  xlab("Date (UTC)")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  ggtitle("DB01 2022")+
  ylim(90, 137)+
  theme(axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        axis.title.x= element_blank())
CB_2000<- ggplot(CB01join_0916_0923, aes(x= UTC, y= OL_2000))+
  geom_daynight(sunrise= 11, sunset= 23)+
  geom_line(linewidth = 0.75)+
  scale_x_datetime(date_breaks = "1 day", date_labels= "%m/%d", minor_breaks = NULL)+
  theme_bw()+
  xlab("Date (UTC)")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  ggtitle("CB01 2022")+
  ylim(90, 137)

DB_2000/CB_2000 + plot_layout(guides= "collect", axis_titles = "collect")
```
#chorus presence & temp
``` {r}
DB01_OLtempPresence <- DB01_OLtemps_daily %>%
  full_join(DB01_chorusPresence)
DB01_OLtempPresence$X500_chorus = factor(DB01_OLtempPresence$X500_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
DB01_OLtempPresence$X1000_chorus = factor(DB01_OLtempPresence$X1000_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
DB01_OLtempPresence$X2000_chorus = factor(DB01_OLtempPresence$X2000_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
ES01_OLtempPresence <- ES01_OLtemps_daily %>%
  full_join(ES01_chorusPresence)
ES01_OLtempPresence$X500_chorus = factor(ES01_OLtempPresence$X500_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
ES01_OLtempPresence$X1000_chorus = factor(ES01_OLtempPresence$X1000_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
ES01_OLtempPresence$X2000_chorus = factor(ES01_OLtempPresence$X2000_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
CB01_OLtempPresence <- CB01_OLtemps_daily %>%
  full_join(CB01_chorusPresence)
CB01_OLtempPresence$X500_chorus = factor(CB01_OLtempPresence$X500_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
CB01_OLtempPresence$X1000_chorus = factor(CB01_OLtempPresence$X1000_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
CB01_OLtempPresence$X2000_chorus = factor(CB01_OLtempPresence$X2000_chorus,
                                        levels= c("no", "yes"),
                                        labels= c("Absent", "Present"))
all_temp_presence <- DB01_OLtempPresence %>%
  full_join(ES01_OLtempPresence) %>%
  full_join(CB01_OLtempPresence)
all_temp_presence <- all_temp_presence %>%
  drop_na(X500_chorus)
all_temp_presence$site = factor(all_temp_presence$site,
                                        levels= c('DB01', 'ES01', 'CB01'),
                                        labels= c('DB01', 'ES01', 'CB01'))

allSite500 <- ggplot(all_temp_presence, aes(x = med_temp, y = med_500, group= X500_chorus:site, color= X500_chorus:site))+
  geom_point(size= 0.85) +
  geom_smooth(method='glm', level= 0.95)+
  stat_poly_eq(formula = y ~ x, 
               aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.., sep = "*`,`~")), 
               parse = TRUE,
               label.x = "left",
               vstep = 0.05)+
  xlab("Median daily temperature (°C))")+
  ylab(expression(paste('Median 500 Hz Octave Level SPL (dB re 1 \u00b5Pa)')))+
  scale_color_manual(labels= c("Absent:DB01", "Absent:ES01", "Absent:CB01","Present:DB01","Present:ES01",  "Present:CB01"), values= c("grey", "grey","grey", "#4B8320",  "red",  "blue"))+
  scale_fill_manual(values= c("grey", "grey","grey", "#4B8320",  "red",  "blue"))+
  theme_bw()+
  guides(color= guide_legend(title= "Chorus Presence"))+
  ylim(72, 120)+
  theme(axis.title= element_text(size= 18),
        axis.text.y= element_text(size= 16),
        axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        legend.position= "none")

allSite1000 <- ggplot(all_temp_presence, aes(x = med_temp, y = med_1000, group= X1000_chorus:site, color= X1000_chorus:site))+
  geom_point(size= 0.85) +
  geom_smooth(method='glm', level= 0.95)+
  stat_poly_eq(formula = y ~ x, 
               aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.., sep = "*`,`~")), 
               parse = TRUE,
               label.x = "left",
               vstep = 0.05)+
  xlab("Median daily temperature (°C))")+
  ylab(expression(paste('Median 1000 Hz Octave Level SPL (dB re 1 \u00b5Pa)')))+
  scale_color_manual(labels= c("Absent:DB01", "Absent:ES01", "Absent:CB01","Present:DB01","Present:ES01",  "Present:CB01"), values= c("grey", "grey","grey", "#4B8320",  "red",  "blue"))+
  scale_fill_manual(values= c("grey", "grey","grey", "#4B8320",  "red",  "blue"))+
  theme_bw()+
  guides(color= guide_legend(title= "Chorus Presence"))+
  ylim(72, 120)+
  theme(axis.title= element_text(size= 18),
        axis.text.y= element_text(size= 16),
        axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        legend.position= "none")+
  facet_wrap("site")

allSite2000 <- ggplot(all_temp_presence, aes(x = med_temp, y = med_2000, group= X2000_chorus:site, color= X2000_chorus:site))+
  geom_point(size= 0.85) +
  geom_smooth(method='glm', level= 0.95)+
  stat_poly_eq(formula = y ~ x, 
               aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.., sep = "*`,`~")), 
               parse = TRUE,
               label.x = "left",
               vstep = 0.05)+
  xlab("Median daily temperature (°C))")+
  ylab(expression(paste('Median 2000 Hz Octave Level SPL (dB re 1 \u00b5Pa)')))+
  scale_color_manual(labels= c("Absent:DB01", "Absent:ES01", "Absent:CB01","Present:DB01","Present:ES01",  "Present:CB01"), values= c("grey", "grey","grey", "#4B8320",  "red",  "blue"))+
  scale_fill_manual(values= c("grey", "grey","grey", "#4B8320",  "red",  "blue"))+
  theme_bw()+
  guides(color= guide_legend(title= "Chorus Presence"))+
  ylim(72, 120)+
  theme(axis.title= element_text(size= 18),
        axis.text= element_text(size= 16),
        axis.ticks.x= element_blank(),
        legend.title= element_text(size= 18),
        legend.text = element_text(size= 18))

all_siteOL<- allSite500/allSite1000/allSite2000+ plot_layout(axis_titles = "collect", guides= "collect")

plot(allSite1000)

#ggsave(here("figs", "all_siteTempsOL.png"), all_siteOL, width= 36, height= 24, units= "in")
```
#minute level data with confirmed chorus presence & moons
```{r}
#need to combine present days and plot those with the minute data- days with chorusing vs days without at minute level
#DB01 202207: 2022-07-10 to 2022-12-16
DB01_202207_minOL <- DB01_202207_minOL %>%
  mutate(UTC_date = date(UTC))
DB01_chorusPresence <- DB01_chorusPresence %>%
  mutate(UTC_date = date(UTC))

DB01subset_0610_1216 <-  seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2022-12-16 00:00:00"), by = "1 min")
with_tz(DB01subset_0610_1216, "GMT")
DB01subset_0610_1216 <- data.frame(UTC= DB01subset_0610_1216)
DB01subset_0610_1216 <- DB01subset_0610_1216 %>%
  mutate(UTC_date = date(UTC))

DB01_chorusExpanded <- DB01subset_0610_1216 %>%
  left_join(DB01_chorusPresence, by = "UTC_date")
DB01_chorusExpanded <- DB01_chorusExpanded[-c(2,3)]
colnames(DB01_chorusExpanded)[1] <- "UTC"

DB01_202206_minOLChorus <- DB01_202207_minOL %>%
  full_join(DB01_chorusExpanded)
DB01_202206_minOLChorus <- with_tz(DB01_202206_minOLChorus, "EST")

DB01_minuteChorus <- ggplot(DB01_202206_minOLChorus, aes(x= UTC, y= OL_1000, group= X1000_chorus, color= X1000_chorus))+
  geom_point(size = 0.5)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%m/%d", minor_breaks = NULL)+
  scale_color_manual(labels= c("no", "yes"), values= c("black", "#4B8320"))+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000 HzOctave Level SPL (db re 1 \u00b5Pa)')))+
  guides(color= guide_legend(title= "DB01 Chorus Presence"))
  
plot(DB01_minuteChorus)

#combo of sunset times w/ fish chorus presence
DB01_minSunsetChorus <- DB01_minSunsetTimes %>%
  left_join(DB01_chorusExpanded, by = "UTC")
DB01_minSunsetChorus <- DB01_minSunsetChorus %>%
  drop_na(X500_chorus)

ggplot(DB01_minSunsetChorus, aes(x= UTC, y= OL_2000, group= X2000_chorus, color= X2000_chorus))+
  geom_point()+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%m/%d", minor_breaks = NULL)+
  scale_color_manual(labels= c("no", "yes"), values= c("black", "#4B8320"))+
  theme_bw()+
  xlab("Date- sunset times")+
  ylab(expression(paste('Median 2000Hz Octave Level SPL (db re 1 \u00b5Pa)')))+
  guides(color= guide_legend(title= "DB01 Chorus Presence"))

#CB01
CB01_202206_minOL <- CB01_202206_minOL %>%
  mutate(UTC_date = date(UTC))
CB01_chorusPresence <- CB01_chorusPresence %>%
  mutate(UTC_date = date(UTC))

CB01subset_0610_1216 <-  seq(ymd_hms("2022-06-10 00:00:00"), ymd_hms("2022-12-16 00:00:00"), by = "1 min")
CB01subset_0610_1216 <- data.frame(UTC= CB01subset_0610_1216)
CB01subset_0610_1216 <- CB01subset_0610_1216 %>%
  mutate(UTC_date = date(UTC))

CB01_chorusExpanded <- CB01subset_0610_1216 %>%
  left_join(CB01_chorusPresence, by = "UTC_date")
CB01_chorusExpanded <- CB01_chorusExpanded[-c(2,3)]
colnames(CB01_chorusExpanded)[1] <- "UTC"

CB01_202206_minOLChorus <- CB01_202206_minOL %>%
  full_join(CB01_chorusExpanded)



CB01_minuteChorus <- ggplot(CB01_202206_minOLChorus, aes(x= UTC, y= OL_1000, group= X1000_chorus, color= X1000_chorus))+
  geom_point(size = 0.5)+
  scale_x_datetime(date_breaks = "3 weeks", date_labels= "%m/%d", minor_breaks = NULL)+
  scale_color_manual(labels= c("no", "yes"), values= c("black", "blue"))+
  theme_bw()+
  xlab("Date")+
  ylab(expression(paste('Median 1000 HzOctave Level SPL (db re 1 \u00b5Pa)')))+
  guides(color= guide_legend(title= "CB01 Chorus Presence"))

DB01_minuteChorus/CB01_minuteChorus +plot_layout(guides= "collect", axis_titles = "collect" )



#adding in moon data
DB01_202206_minOLChorus <- DB01_202206_minOLChorus %>%
  left_join(moon_phases)

```
#plot acoustic scene
```{r}
DB01_chorusPresence <- DB01_chorusPresence %>%
  mutate(UTC_date = date(UTC))

DB01subset_0707_1104 <-  seq(ymd_hms("2022-07-06 19:00:00"), ymd_hms("2024-11-03 19:00:00"), by = "1 hour")
with_tz(DB01subset_0707_1104, "GMT")
DB01subset_0707_1104 <- data.frame(UTC= DB01subset_0707_1104)
DB01subset_0707_1104 <- DB01subset_0707_1104 %>%
  mutate(UTC_date = date(UTC))

DB01_hourchorusExpanded <- DB01subset_0707_1104 %>%
  left_join(DB01_chorusPresence, by = "UTC_date")
DB01_hourchorusExpanded <- DB01_hourchorusExpanded[-c(2,3)]
colnames(DB01_hourchorusExpanded)[1] <- "UTC_fixed"

DB01_OLChorus <- DB01_OL %>%
  full_join(DB01_hourchorusExpanded)
DB01_OLChorus <- DB01_OLChorus[-c(1)]
colnames(DB01_OLChorus)[16] <- "UTC"


plotAcousticScene(DB01_OLChorus)










```